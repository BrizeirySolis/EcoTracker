import{a as E,b as F,c as P}from"./chunk-WTXJWYYU.js";import{Ba as k,Ca as y,Da as I,Fa as U,Ga as p,I as R,Ja as x,Ka as H,Na as c,R as u,S as h,T as S,ba as b,h as C,k as g,oa as T,q as A,t as m,u as l}from"./chunk-LRAL7NZY.js";var e=class t{constructor(r,o){this.router=r;this.authService=o}canActivate(r,o){if(this.authService.isLoggedIn()){if(r.data.roles&&r.data.roles.length){let i=this.authService.currentUserValue?.roles||[];if(!r.data.roles.some(n=>i.includes(n)))return this.router.navigate(["/home"]),!1}return!0}return this.router.navigate(["/login"],{queryParams:{returnUrl:o.url}}),!1}static \u0275fac=function(o){return new(o||t)(m(p),m(c))};static \u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"})};var w=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-EAUNTU3R.js").then(t=>t.HomeComponent)},{path:"login",loadComponent:()=>import("./chunk-WWWVEAFK.js").then(t=>t.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-DFZ44USO.js").then(t=>t.RegisterComponent)},{path:"habitos",loadComponent:()=>import("./chunk-XDNELA5H.js").then(t=>t.HabitsComponent),canActivate:[e]},{path:"luz",loadComponent:()=>import("./chunk-CNPPGTUI.js").then(t=>t.ElectricityFormComponent),canActivate:[e]},{path:"agua",loadComponent:()=>import("./chunk-DJQADZLK.js").then(t=>t.WaterFormComponent),canActivate:[e]},{path:"transporte",loadComponent:()=>import("./chunk-J33BWB37.js").then(t=>t.TransportFormComponent),canActivate:[e]},{path:"profile",loadComponent:()=>import("./chunk-WT7KZOEY.js").then(t=>t.ProfileComponent),canActivate:[e]},{path:"bitacoras",loadComponent:()=>import("./chunk-7YUMQYRQ.js").then(t=>t.BitacoraListComponent),canActivate:[e]},{path:"bitacoras/new",loadComponent:()=>import("./chunk-4OWZVSAM.js").then(t=>t.BitacoraFormComponent),canActivate:[e]},{path:"bitacoras/edit/:id",loadComponent:()=>import("./chunk-4OWZVSAM.js").then(t=>t.BitacoraFormComponent),canActivate:[e]},{path:"bitacoras/:id",loadComponent:()=>import("./chunk-HOJPQXRU.js").then(t=>t.BitacoraDetailComponent),canActivate:[e]},{path:"bitacoras/timeline",loadComponent:()=>import("./chunk-5ROVRLTX.js").then(t=>t.BitacoraTimelineComponent),canActivate:[e]},{path:"**",redirectTo:"/home"}];var B=(t,r)=>{let o=l(c),i=l(p);console.log(`Interceptando solicitud a: ${t.url}`);let a=localStorage.getItem("currentUser");console.log("Usuario en localStorage:",a?"Presente":"Ausente");let d=o.currentUserValue;if(console.log("Usuario en servicio:",d?"Presente":"Ausente"),t.url.includes("/api/")&&a){let n=JSON.parse(a);if(n&&n.token){let f=n.token.startsWith("Bearer ")?n.token:`Bearer ${n.token}`;console.log(`A\xF1adiendo token a solicitud: ${f.substring(0,20)}...`);let M=t.clone({headers:t.headers.set("Authorization",f)});return r(M).pipe(g(v=>(v.status===401&&(console.error("Error 401: Token inv\xE1lido o expirado"),localStorage.removeItem("currentUser"),o.logout(),i.navigate(["/login"],{queryParams:{returnUrl:i.url}})),C(()=>v))))}}return console.log("Solicitud sin token de autorizaci\xF3n"),r(t)};var O={providers:[T({eventCoalescing:!0}),x(w,H({skipInitialTransition:!0,onViewTransitionCreated:t=>{console.log("View transition created for:",t.to.url)}})),k(y([B])),F,P,E]};var s=class t{title="EcoTracker";static \u0275fac=function(o){return new(o||t)};static \u0275cmp=R({type:t,selectors:[["app-root"]],decls:5,vars:0,template:function(o,i){o&1&&(u(0,"main"),S(1,"router-outlet"),h(),u(2,"footer")(3,"p"),b(4,"\xA9 2025 EcoTracker - Proyecto educativo"),h()())},dependencies:[U],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;min-height:100vh}main[_ngcontent-%COMP%]{flex:1}footer[_ngcontent-%COMP%]{background-color:#333;color:#fff;text-align:center;padding:16px;margin-top:40px}"]})};I(s,O).catch(t=>console.error(t));
