import{a as E,d as Y}from"./chunk-V6Z4GT7X.js";import{a as U}from"./chunk-DMCUYUFQ.js";import{c as H,h as W,n as R,o as $,p as q,t as X}from"./chunk-NX5UWNHD.js";import{a as G}from"./chunk-HPUDPAOB.js";import"./chunk-EENQT4EC.js";import{$ as i,A as f,B as x,C as m,D as _,Ha as j,Ia as z,L as a,N as T,Na as A,O as L,Pa as N,S as g,U as y,V as c,W as I,_ as n,_a as B,aa as p,da as h,ea as u,fa as s,la as r,ma as M,na as v,o as C,oa as w,pa as D,qa as F,ra as V,ta as O,ua as k,wa as P,ya as S}from"./chunk-HBL3S35I.js";var K=()=>["/metas/new"],Q=o=>["/metas",o],Z=o=>["/metas/edit",o];function ee(o,t){if(o&1&&(n(0,"option",17),r(1),i()),o&2){let e=t.$implicit;c("value",e[0]),a(),M(e[1])}}function te(o,t){o&1&&(n(0,"div",18),p(1,"div",19),n(2,"p"),r(3,"Cargando metas..."),i()())}function ne(o,t){o&1&&(n(0,"p"),r(1,"No hay metas en la categor\xEDa seleccionada."),i())}function ie(o,t){o&1&&(n(0,"p"),r(1,"Comienza creando tu primera meta ambiental para monitorear tu progreso."),i())}function oe(o,t){if(o&1&&(n(0,"div",20),m(),n(1,"svg",21),p(2,"line",22)(3,"line",23)(4,"circle",24)(5,"circle",25)(6,"line",26)(7,"line",27)(8,"line",28),i(),_(),n(9,"h3"),r(10,"No hay metas disponibles"),i(),g(11,ne,2,0,"p",29)(12,ie,2,0,"p",29),n(13,"a",30),r(14,"Crear primera meta"),i()()),o&2){let e=s();a(11),c("ngIf",e.selectedTipo),a(),c("ngIf",!e.selectedTipo),a(),c("routerLink",O(3,K))}}function re(o,t){if(o&1){let e=h();n(0,"div",31),m(),n(1,"svg",32),p(2,"circle",33)(3,"line",34)(4,"line",35),i(),_(),n(5,"p"),r(6),i(),n(7,"button",36),u("click",function(){f(e);let d=s();return x(d.loadMetas())}),r(8,"Reintentar"),i()()}if(o&2){let e=s();a(6),M(e.error)}}function ae(o,t){if(o&1&&(n(0,"p",61),r(1),i()),o&2){let e=s().$implicit,l=s(2);a(),v(" ",l.truncateText(e.descripcion,100)," ")}}function le(o,t){if(o&1){let e=h();n(0,"div",39)(1,"div",40),p(2,"div",41),i(),n(3,"div",42),r(4),i(),n(5,"div",43)(6,"h3",44),r(7),i(),g(8,ae,2,1,"p",45),n(9,"div",46)(10,"div",47),r(11),P(12,"date"),P(13,"date"),i(),n(14,"div",48),r(15),i()(),n(16,"div",49)(17,"span"),r(18,"Progreso actual"),i(),n(19,"span",50),r(20),i()(),n(21,"div",51)(22,"a",52),m(),n(23,"svg",53),p(24,"path",54)(25,"circle",55),i(),r(26," Ver "),i(),_(),n(27,"a",56),m(),n(28,"svg",53),p(29,"path",57),i(),r(30," Editar "),i(),_(),n(31,"button",58),u("click",function(){let d=f(e).$implicit,b=s(2);return x(b.confirmDelete(d))}),m(),n(32,"svg",53),p(33,"polyline",59)(34,"path",60),i(),r(35," Eliminar "),i()()()()}if(o&2){let e=t.$implicit,l=s(2);a(2),I("width",l.calcularPorcentaje(e)+"%"),y("data-category",e.tipo),a(),y("data-category",e.tipo),a(),v(" ",l.getTipoName(e.tipo)," "),a(3),M(e.titulo),a(),c("ngIf",e.descripcion),a(3),w("",S(12,14,e.fechaInicio,"dd/MM/yyyy")," - ",S(13,17,e.fechaFin,"dd/MM/yyyy"),""),a(4),w("Meta: ",e.valorObjetivo," ",l.getUnidadAbreviada(e.unidad),""),a(5),v("",l.calcularPorcentaje(e).toFixed(0),"%"),a(2),c("routerLink",k(20,Q,e.id)),a(5),c("routerLink",k(22,Z,e.id))}}function ce(o,t){if(o&1&&(n(0,"div",37),g(1,le,36,24,"div",38),i()),o&2){let e=s();a(),c("ngForOf",e.metas)}}function se(o,t){o&1&&(n(0,"span"),r(1,"Eliminar"),i())}function de(o,t){o&1&&(n(0,"span"),r(1,"Eliminando..."),i())}function pe(o,t){if(o&1){let e=h();n(0,"div",62)(1,"div",63)(2,"div",64)(3,"div",65)(4,"h3"),r(5,"Confirmar eliminaci\xF3n"),i(),n(6,"button",66),u("click",function(){f(e);let d=s();return x(d.cancelDelete())}),m(),n(7,"svg",32),p(8,"line",67)(9,"line",68),i()()(),_(),n(10,"div",69)(11,"p"),r(12,"\xBFEst\xE1s seguro de que deseas eliminar la meta "),n(13,"strong"),r(14),i(),r(15,"?"),i(),n(16,"p",70),r(17,"Esta acci\xF3n no se puede deshacer."),i()(),n(18,"div",71)(19,"button",72),u("click",function(){f(e);let d=s();return x(d.cancelDelete())}),r(20,"Cancelar"),i(),n(21,"button",73),u("click",function(){f(e);let d=s();return x(d.deleteMeta())}),g(22,se,2,0,"span",29)(23,de,2,0,"span",29),i()()()()()}if(o&2){let e=s();a(14),v('"',e.metaToDelete==null?null:e.metaToDelete.titulo,'"'),a(7),c("disabled",e.deleting),a(),c("ngIf",!e.deleting),a(),c("ngIf",e.deleting)}}var J=class o{constructor(t){this.metaService=t}metas=[];loading=!0;error=null;selectedTipo="";tipoEntries=Object.entries(E);showDeleteModal=!1;metaToDelete=null;deleting=!1;metasSubscription=null;consumptionSubscription=null;ngOnInit(){this.metasSubscription=this.metaService.metas$.subscribe(t=>{this.metas=t,this.loading=!1}),this.loadAndUpdateMetas()}ngOnDestroy(){this.metasSubscription&&this.metasSubscription.unsubscribe(),this.consumptionSubscription&&this.consumptionSubscription.unsubscribe()}loadAndUpdateMetas(){this.loading=!0,this.error=null,this.metaService.getAllMetas(!0,this.selectedTipo).subscribe({next:t=>{this.updateAllMetasProgress()},error:t=>{this.error=t.message||"Error al cargar las metas",this.loading=!1}})}updateAllMetasProgress(){let t=this.metas.filter(e=>e.tipoEvaluacion==="automatica"&&e.estado==="en_progreso");if(t.length===0){this.loading=!1;return}this.metaService.refreshMultipleMetas(t).pipe(C(()=>this.loading=!1)).subscribe({next:e=>{console.log("Metas actualizadas autom\xE1ticamente:",e)},error:e=>{console.error("Error al actualizar metas:",e)}})}loadMetasWithRefresh(){this.loading=!0,this.error=null,this.metaService.refreshAllMetas(this.selectedTipo).subscribe({next:()=>{this.loadMetas()},error:t=>{console.error("Error al actualizar las metas:",t),this.loadMetas()}})}loadMetas(){this.loading=!0,this.error=null,this.metaService.getAllMetas(!0,this.selectedTipo).subscribe({next:t=>{},error:t=>{this.error=t.message||"Error al cargar las metas"},complete:()=>{this.loading=!1}})}onTipoFilterChange(){this.loadMetasWithRefresh()}getTipoName(t){return E[t]||t}getUnidadAbreviada(t){switch(t){case"m3":return"m\xB3";case"kwh":return"kWh";case"km":return"km";case"porcentaje":return"%";case"co2":return"kg CO\u2082";case"costo":return"MXN";case"unidad":return"uds";default:return t}}calcularPorcentaje(t){return Y(t)}truncateText(t,e){return t.length<=e?t:t.slice(0,e)+"..."}confirmDelete(t){this.metaToDelete=t,this.showDeleteModal=!0}cancelDelete(){this.showDeleteModal=!1,this.metaToDelete=null}deleteMeta(){!this.metaToDelete||this.deleting||(this.deleting=!0,this.metaService.deleteMeta(this.metaToDelete.id).pipe(C(()=>{this.deleting=!1,this.showDeleteModal=!1,this.metaToDelete=null})).subscribe({next:()=>{console.log("Meta eliminada exitosamente")},error:t=>{this.error=t.message||"Error al eliminar la meta"}}))}static \u0275fac=function(e){return new(e||o)(T(U))};static \u0275cmp=L({type:o,selectors:[["app-meta-list"]],decls:23,vars:9,consts:[[1,"container"],[1,"metas-header"],[1,"actions"],[1,"filter-container"],["for","tipo-filter"],["id","tipo-filter",1,"tipo-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn-create",3,"routerLink"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","error-message",4,"ngIf"],["class","metas-grid",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[3,"value"],[1,"loading-container"],[1,"loading-spinner"],[1,"empty-state"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","1","stroke-linecap","round","stroke-linejoin","round"],["x1","8","y1","19","x2","8","y2","21"],["x1","16","y1","19","x2","16","y2","21"],["cx","8","cy","6","r","3"],["cx","16","cy","6","r","3"],["x1","8","y1","9","x2","8","y2","15"],["x1","16","y1","9","x2","16","y2","15"],["x1","8","y1","12","x2","16","y2","12"],[4,"ngIf"],[1,"btn-create-empty",3,"routerLink"],[1,"error-message"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","12"],["x1","12","y1","16","x2","12.01","y2","16"],[1,"btn-retry",3,"click"],[1,"metas-grid"],["class","meta-card",4,"ngFor","ngForOf"],[1,"meta-card"],[1,"meta-progress-bar"],[1,"progress-fill"],[1,"meta-category"],[1,"meta-content"],[1,"meta-title"],["class","meta-description",4,"ngIf"],[1,"meta-info"],[1,"meta-dates"],[1,"meta-value"],[1,"meta-progress"],[1,"progress-percentage"],[1,"meta-actions"],[1,"btn-view",3,"routerLink"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"],["cx","12","cy","12","r","3"],[1,"btn-edit",3,"routerLink"],["d","M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"],[1,"btn-delete",3,"click"],["points","3 6 5 6 21 6"],["d","M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"],[1,"meta-description"],[1,"modal-overlay"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"btn-close",3,"click"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"modal-body"],[1,"warning-text"],[1,"modal-footer"],[1,"btn-cancel",3,"click"],[1,"btn-confirm-delete",3,"click","disabled"]],template:function(e,l){e&1&&(p(0,"app-navbar"),n(1,"div",0)(2,"div",1)(3,"h2"),r(4,"Mis Metas Ambientales"),i(),n(5,"div",2)(6,"div",3)(7,"label",4),r(8,"Filtrar por:"),i(),n(9,"select",5),V("ngModelChange",function(b){return F(l.selectedTipo,b)||(l.selectedTipo=b),b}),u("change",function(){return l.onTipoFilterChange()}),n(10,"option",6),r(11,"Todas las categor\xEDas"),i(),g(12,ee,2,2,"option",7),i()(),n(13,"a",8),m(),n(14,"svg",9),p(15,"line",10)(16,"line",11),i(),r(17," Crear Meta "),i()()(),g(18,te,4,0,"div",12)(19,oe,15,4,"div",13)(20,re,9,1,"div",14)(21,ce,2,1,"div",15)(22,pe,24,4,"div",16),i()),e&2&&(a(9),D("ngModel",l.selectedTipo),a(3),c("ngForOf",l.tipoEntries),a(),c("routerLink",O(8,K)),a(5),c("ngIf",l.loading),a(),c("ngIf",!l.loading&&l.metas.length===0),a(),c("ngIf",l.error),a(),c("ngIf",!l.loading&&l.metas.length>0),a(),c("ngIf",l.showDeleteModal))},dependencies:[N,j,z,A,B,X,$,q,R,H,W,G],styles:['@charset "UTF-8";.container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.metas-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px}.metas-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#00b359;margin:0}.actions[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;flex-wrap:wrap}.filter-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.tipo-select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #ccc;border-radius:4px;background-color:#fff;font-size:.9rem}.btn-create[_ngcontent-%COMP%]{display:inline-flex;align-items:center;background-color:#00b359;color:#fff;text-decoration:none;padding:8px 16px;border-radius:4px;font-weight:500;gap:8px;transition:background-color .3s ease}.btn-create[_ngcontent-%COMP%]:hover{background-color:#00994d}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 0}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(0,179,89,.2);border-radius:50%;border-top-color:#00b359;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px 0;color:#666}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#aaa;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:12px;color:#333}.btn-create-empty[_ngcontent-%COMP%]{display:inline-block;background-color:#00b359;color:#fff;text-decoration:none;padding:10px 20px;border-radius:4px;font-weight:500;margin-top:16px;transition:background-color .3s ease}.btn-create-empty[_ngcontent-%COMP%]:hover{background-color:#00994d}.error-message[_ngcontent-%COMP%]{background-color:#f8d7da;border:1px solid #f5c6cb;border-radius:4px;padding:16px;margin-bottom:24px;color:#721c24;display:flex;align-items:center;gap:12px}.btn-retry[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;border-radius:4px;padding:6px 12px;cursor:pointer;margin-left:auto}.metas-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:24px}.meta-card[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #0000001a;background-color:#fff;transition:transform .3s ease,box-shadow .3s ease;position:relative}.meta-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 4px 12px #00000026}.meta-progress-bar[_ngcontent-%COMP%]{height:8px;width:100%;background-color:#e0e0e0}.progress-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s ease}.progress-fill[data-category=agua][_ngcontent-%COMP%]{background-color:var(--color-agua-primary, #0288D1)}.progress-fill[data-category=electricidad][_ngcontent-%COMP%]{background-color:var(--color-electricidad-primary, #FFB300)}.progress-fill[data-category=transporte][_ngcontent-%COMP%]{background-color:var(--color-transporte-primary, #43A047)}.progress-fill[data-category=combinada][_ngcontent-%COMP%]{background-color:#9c27b0}.progress-fill[data-category=otro][_ngcontent-%COMP%]{background-color:#607d8b}.meta-category[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;font-size:.8rem;font-weight:600;padding:4px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.5px}.meta-category[data-category=agua][_ngcontent-%COMP%]{background-color:var(--color-agua-light, #B3E5FC);color:var(--color-agua-dark, #01579B)}.meta-category[data-category=electricidad][_ngcontent-%COMP%]{background-color:var(--color-electricidad-light, #FFECB3);color:var(--color-electricidad-dark, #FF8F00)}.meta-category[data-category=transporte][_ngcontent-%COMP%]{background-color:var(--color-transporte-light, #C8E6C9);color:var(--color-transporte-dark, #2E7D32)}.meta-category[data-category=combinada][_ngcontent-%COMP%]{background-color:#e1bee7;color:#6a1b9a}.meta-category[data-category=otro][_ngcontent-%COMP%]{background-color:#eceff1;color:#455a64}.meta-content[_ngcontent-%COMP%]{padding:16px}.meta-title[_ngcontent-%COMP%]{font-size:1.2rem;margin:0 0 8px;padding-right:80px;color:#333}.meta-description[_ngcontent-%COMP%]{font-size:.95rem;color:#555;margin:0 0 16px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.meta-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:12px;font-size:.9rem}.meta-dates[_ngcontent-%COMP%]{color:#666}.meta-value[_ngcontent-%COMP%]{font-weight:600}.meta-progress[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:.9rem;margin-bottom:16px}.progress-percentage[_ngcontent-%COMP%]{font-weight:600}.meta-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.btn-view[_ngcontent-%COMP%], .btn-edit[_ngcontent-%COMP%], .btn-delete[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;border-radius:4px;font-size:.9rem;cursor:pointer;transition:all .2s ease;text-decoration:none}.btn-view[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2;border:1px solid #bbdefb}.btn-edit[_ngcontent-%COMP%]{background-color:#fff8e1;color:#ff8f00;border:1px solid #ffe082}.btn-delete[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828;border:1px solid #ffcdd2}.btn-view[_ngcontent-%COMP%]:hover{background-color:#bbdefb}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#ffe082}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#ffcdd2}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-dialog[_ngcontent-%COMP%]{width:100%;max-width:500px;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 4px 12px #0003}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #eee}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333}.btn-close[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#666}.modal-body[_ngcontent-%COMP%]{padding:16px}.warning-text[_ngcontent-%COMP%]{color:#dc3545;font-weight:500}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;padding:16px;border-top:1px solid #eee}.btn-cancel[_ngcontent-%COMP%], .btn-confirm-delete[_ngcontent-%COMP%]{padding:8px 16px;border-radius:4px;font-weight:500;cursor:pointer}.btn-cancel[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #dee2e6;color:#212529}.btn-confirm-delete[_ngcontent-%COMP%]{background-color:#dc3545;border:1px solid #dc3545;color:#fff}.btn-cancel[_ngcontent-%COMP%]:hover{background-color:#e2e6ea}.btn-confirm-delete[_ngcontent-%COMP%]:hover{background-color:#c82333}.btn-confirm-delete[_ngcontent-%COMP%]:disabled{background-color:#e4606d;cursor:not-allowed}@media (max-width: 768px){.metas-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.actions[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.metas-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}']})};export{J as MetaListComponent};
