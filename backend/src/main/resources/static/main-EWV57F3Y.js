import{a as w,b as x,c as F}from"./chunk-63EGQU4R.js";import{b as p}from"./chunk-EENQT4EC.js";import{$ as d,Aa as T,O as R,Ta as k,Ua as y,Va as E,Ya as H,Za as c,_ as u,aa as S,ab as I,bb as U,j as v,la as b,n as g,u as A,x as s,y as l}from"./chunk-HBL3S35I.js";var e=class t{constructor(r,o){this.router=r;this.authService=o}canActivate(r,o){if(this.authService.isLoggedIn()){if(r.data.roles&&r.data.roles.length){let a=this.authService.currentUserValue?.roles||[];if(!r.data.roles.some(n=>a.includes(n)))return this.router.navigate(["/home"]),!1}return!0}return this.router.navigate(["/login"],{queryParams:{returnUrl:o.url}}),!1}static \u0275fac=function(o){return new(o||t)(s(c),s(p))};static \u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"})};var M=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-7T5TNA2E.js").then(t=>t.HomeComponent)},{path:"login",loadComponent:()=>import("./chunk-BA5MCCNW.js").then(t=>t.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-WT3PNMQH.js").then(t=>t.RegisterComponent)},{path:"habitos",loadComponent:()=>import("./chunk-TSNIGVVA.js").then(t=>t.HabitsComponent),canActivate:[e]},{path:"luz",loadComponent:()=>import("./chunk-J63L6TS6.js").then(t=>t.ElectricityFormComponent),canActivate:[e]},{path:"agua",loadComponent:()=>import("./chunk-TUVNJLQX.js").then(t=>t.WaterFormComponent),canActivate:[e]},{path:"transporte",loadComponent:()=>import("./chunk-UBATIHOG.js").then(t=>t.TransportFormComponent),canActivate:[e]},{path:"profile",loadComponent:()=>import("./chunk-ZBH72GVJ.js").then(t=>t.ProfileComponent),canActivate:[e]},{path:"bitacoras",loadComponent:()=>import("./chunk-IGXRZIMT.js").then(t=>t.BitacoraListComponent),canActivate:[e]},{path:"bitacoras/new",loadComponent:()=>import("./chunk-UYHKUB4C.js").then(t=>t.BitacoraFormComponent),canActivate:[e]},{path:"bitacoras/edit/:id",loadComponent:()=>import("./chunk-UYHKUB4C.js").then(t=>t.BitacoraFormComponent),canActivate:[e]},{path:"bitacoras/:id",loadComponent:()=>import("./chunk-Y6W5PZRA.js").then(t=>t.BitacoraDetailComponent),canActivate:[e]},{path:"bitacoras/timeline",loadComponent:()=>import("./chunk-BI4J64MF.js").then(t=>t.BitacoraTimelineComponent),canActivate:[e]},{path:"metas",loadComponent:()=>import("./chunk-WW7RKBFC.js").then(t=>t.MetaListComponent),canActivate:[e]},{path:"metas/new",loadComponent:()=>import("./chunk-CUVPEAFX.js").then(t=>t.MetaFormComponent),canActivate:[e]},{path:"metas/edit/:id",loadComponent:()=>import("./chunk-CUVPEAFX.js").then(t=>t.MetaFormComponent),canActivate:[e]},{path:"metas/:id",loadComponent:()=>import("./chunk-CJVP6UHP.js").then(t=>t.MetaDetailComponent),canActivate:[e]},{path:"educacion",loadComponent:()=>import("./chunk-7C2GUEGK.js").then(t=>t.EducationHomeComponent),canActivate:[e],data:{title:"Centro Educativo",description:"Aprende t\xE9cnicas para reducir tu impacto ambiental"}},{path:"educacion/agua",redirectTo:"educacion/categoria/agua",pathMatch:"full"},{path:"educacion/electricidad",redirectTo:"educacion/categoria/electricidad",pathMatch:"full"},{path:"educacion/transporte",redirectTo:"educacion/categoria/transporte",pathMatch:"full"},{path:"educacion/categoria/:categoria",loadComponent:()=>import("./chunk-RDFQNQL3.js").then(t=>t.CategoryViewComponent),canActivate:[e],data:{title:"Categor\xEDa Educativa",description:"Art\xEDculos de una categor\xEDa espec\xEDfica"}},{path:"educacion/:tipo/:slug",loadComponent:()=>import("./chunk-AGJUMAAP.js").then(t=>t.ArticleViewerComponent),canActivate:[e],data:{title:"Art\xEDculo Educativo",description:"Contenido educativo sobre sostenibilidad"}},{path:"**",redirectTo:"/home"}];var P=(t,r)=>{let o=l(p),a=l(c);console.log(`Interceptando solicitud a: ${t.url}`);let i=localStorage.getItem("currentUser");console.log("Usuario en localStorage:",i?"Presente":"Ausente");let h=o.currentUserValue;if(console.log("Usuario en servicio:",h?"Presente":"Ausente"),t.url.includes("/api/")&&i){let n=JSON.parse(i);if(n&&n.token){let f=n.token.startsWith("Bearer ")?n.token:`Bearer ${n.token}`;console.log(`A\xF1adiendo token a solicitud: ${f.substring(0,20)}...`);let O=t.clone({headers:t.headers.set("Authorization",f)});return r(O).pipe(g(C=>(C.status===401&&(console.error("Error 401: Token inv\xE1lido o expirado"),localStorage.removeItem("currentUser"),o.logout(),a.navigate(["/login"],{queryParams:{returnUrl:a.url}})),v(()=>C))))}}return console.log("Solicitud sin token de autorizaci\xF3n"),r(t)};var B={providers:[T({eventCoalescing:!0}),I(M,U({skipInitialTransition:!0,onViewTransitionCreated:t=>{console.log("View transition created for:",t.to.url)}})),k(y([P])),x,F,w]};var m=class t{title="EcoTracker";static \u0275fac=function(o){return new(o||t)};static \u0275cmp=R({type:t,selectors:[["app-root"]],decls:5,vars:0,template:function(o,a){o&1&&(u(0,"main"),S(1,"router-outlet"),d(),u(2,"footer")(3,"p"),b(4,"\xA9 2025 EcoTracker - Proyecto educativo"),d()())},dependencies:[H],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;min-height:100vh}main[_ngcontent-%COMP%]{flex:1}footer[_ngcontent-%COMP%]{background-color:#333;color:#fff;text-align:center;padding:16px;margin-top:40px}"]})};E(m,B).catch(t=>console.error(t));
