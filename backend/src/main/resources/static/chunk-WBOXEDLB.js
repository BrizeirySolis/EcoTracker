import{s as P}from"./chunk-K5VQB3RE.js";var K=class d{generateSparklinePath(t){if(t.length===0)return"";let e=Math.min(...t),o=Math.max(...t)-e||1;return`M ${t.map((a,i)=>{let c=i/(t.length-1||1)*100,l=35-((a-e)/o*30+5);return`${c},${l}`}).join(" L ")}`}getSparklineEndPoint(t){if(t.length===0)return;let e=Math.min(...t),o=Math.max(...t)-e||1;return{x:100,y:35-((t[t.length-1]-e)/o*30+5)}}static \u0275fac=function(e){return new(e||d)};static \u0275prov=P({token:d,factory:d.\u0275fac,providedIn:"root"})};var I=class d{STATE_BENCHMARK_ELECTRICITY=280;NATIONAL_BENCHMARK_ELECTRICITY=250;CO2_PER_KWH=.527;constructor(){}generateElectricityKpis(t,e){if(!t||t.length===0)return this.generateEmptyKpis();let n=[...t].sort((s,p)=>new Date(s.date).getTime()-new Date(p.date).getTime()),o=this.groupBimonthlyData(n),r=o.map(s=>s.reduce((p,C)=>p+C.kilowatts,0)),a=o.map(s=>s.reduce((p,C)=>p+C.cost,0)),i=this.calculateMovingAverages(r),c=r[r.length-1]||0,l=r.length>1?r[r.length-2]:c,g=l>0?(c-l)/l*100:0,y=a[a.length-1]||0,k=c>0?y/c:0,f=r.map((s,p)=>{let C=a[p];return s>0?C/s:0}).filter(s=>s>0),v=f.length>0?f.reduce((s,p)=>s+p,0)/f.length:0,E=v>0?(k-v)/v*100:0,h=i.length>0?i[i.length-1]:c,u=h>0?(c-h)/h*100:0,R=this.getBenchmarkStatus(c,this.STATE_BENCHMARK_ELECTRICITY,this.NATIONAL_BENCHMARK_ELECTRICITY),T={value:g,direction:g>0?"up":g<0?"down":"neutral",isPositive:g<=0},x={value:u,direction:u>0?"up":u<0?"down":"neutral",isPositive:u<=10&&u>=-10},b=r.filter((s,p)=>{let C=i[p];return C&&s>C*1.2}).length,A=Math.max(0,(h-c)*this.CO2_PER_KWH),S=e.generateSparklinePath(r),M=e.getSparklineEndPoint(r),N=e.generateSparklinePath(a),_=e.getSparklineEndPoint(a),U=e.generateSparklinePath(i),m=e.getSparklineEndPoint(i);return[{title:"Consumo Actual",primaryValue:c.toFixed(1),primaryUnit:"kWh",secondaryValue:g.toFixed(1)+"%",secondaryUnit:"vs anterior",status:this.getStatusFromPercentChange(g,!1),trend:T,footerText:"\xDAltimo periodo bimestral",sparklinePath:S,sparklineEndPoint:M},{title:"Costo Energ\xE9tico",primaryValue:y.toFixed(0),primaryUnit:"MXN",secondaryValue:k.toFixed(2),secondaryUnit:"MXN/kWh",status:this.getStatusFromPercentChange(E,!1),trend:{value:E,direction:E>0?"up":E<0?"down":"neutral",isPositive:E<=0},footerText:`Promedio hist\xF3rico: ${v.toFixed(2)} MXN/kWh`,sparklinePath:N,sparklineEndPoint:_},{title:"Promedio M\xF3vil",primaryValue:h.toFixed(1),primaryUnit:"kWh",secondaryValue:Math.abs(u).toFixed(1)+"%",secondaryUnit:u>=0?"por encima":"por debajo",status:this.getStatusFromDeviation(u),trend:x,footerText:"Basado en los \xFAltimos 3 periodos",sparklinePath:U,sparklineEndPoint:m},{title:"Comparativa",primaryValue:c.toFixed(1),primaryUnit:"kWh",secondaryValue:this.NATIONAL_BENCHMARK_ELECTRICITY.toFixed(1),secondaryUnit:"kWh (promedio nacional)",status:R,footerText:c<this.NATIONAL_BENCHMARK_ELECTRICITY?"Tu consumo est\xE1 por debajo del promedio nacional":"Tu consumo est\xE1 por encima del promedio nacional"},{title:"Anomal\xEDas Detectadas",primaryValue:b.toString(),primaryUnit:b===1?"periodo":"periodos",status:this.getStatusFromAnomalyCount(b),footerText:b>0?"Periodos con consumo inusualmente alto":"No se detectaron consumos anormales"},{title:"Ahorro de CO2",primaryValue:A.toFixed(1),primaryUnit:"kg",status:A>0?"success":"neutral",footerText:A>0?"CO2 no emitido vs. promedio":"Sin ahorro respecto al promedio"}]}generateEmptyKpis(){return[{title:"Consumo Actual",primaryValue:"0",primaryUnit:"kWh",status:"neutral",footerText:"No hay datos disponibles"},{title:"Costo Energ\xE9tico",primaryValue:"0",primaryUnit:"MXN",status:"neutral",footerText:"No hay datos disponibles"},{title:"Promedio M\xF3vil",primaryValue:"0",primaryUnit:"kWh",status:"neutral",footerText:"No hay datos disponibles"},{title:"Comparativa",primaryValue:"0",primaryUnit:"kWh",secondaryValue:this.NATIONAL_BENCHMARK_ELECTRICITY.toFixed(1),secondaryUnit:"kWh (promedio nacional)",status:"neutral",footerText:"No hay datos para comparar"},{title:"Anomal\xEDas Detectadas",primaryValue:"0",primaryUnit:"periodos",status:"neutral",footerText:"No hay datos para analizar"},{title:"Ahorro de CO2",primaryValue:"0",primaryUnit:"kg",status:"neutral",footerText:"No hay datos disponibles"}]}groupBimonthlyData(t){if(t.length===0)return[];let e=[],n=[],o=-1;for(let r of t){let a=new Date(r.date),i=Math.floor(a.getMonth()/2)+a.getFullYear()*6;o===-1?(o=i,n.push(r)):i===o?n.push(r):(e.push([...n]),n=[r],o=i)}return n.length>0&&e.push(n),e}calculateMovingAverages(t){let e=[];for(let n=0;n<t.length;n++){let o=Math.max(0,n-2),r=t.slice(o,n+1),a=r.reduce((i,c)=>i+c,0);e.push(a/r.length)}return e}getStatusFromPercentChange(t,e){return e?t>10?"success":t<0?"danger":"warning":t<0?"success":t>10?"danger":"warning"}getStatusFromDeviation(t){return Math.abs(t)<=10?"success":"warning"}getBenchmarkStatus(t,e,n){return t<e?"success":t>n?"danger":"warning"}getStatusFromAnomalyCount(t){return t===0?"success":t>2?"danger":"warning"}static \u0275fac=function(e){return new(e||d)};static \u0275prov=P({token:d,factory:d.\u0275fac,providedIn:"root"})};var V=class d{CO2_PER_KM_CAR=.192;CO2_PER_KM_BUS=.105;CO2_PER_KM_BICYCLE=0;CO2_PER_KM_WALK=0;CO2_PER_KM_OTHER=.15;AVG_MONTHLY_KM=300;SUSTAINABLE_TRANSPORT_TARGET=.4;constructor(){}generateTransportKpis(t,e){if(!t||t.length===0)return this.generateEmptyKpis();let n=[...t].sort((m,s)=>new Date(m.date).getTime()-new Date(s.date).getTime()),o=this.groupMonthlyData(n),r=o.map(m=>m.reduce((s,p)=>s+p.kilometers,0)),a=o.map(m=>m.reduce((s,p)=>s+p.cost,0)),i=o.map(m=>m.reduce((s,p)=>s+this.calculateCO2(p),0)),c=this.calculateMovingAverages(r),l=r[r.length-1]||0,g=r.length>1?r[r.length-2]:l,y=g>0?(l-g)/g*100:0,k=a[a.length-1]||0,f=i[i.length-1]||0,v=o[o.length-1]||[],E=v.filter(m=>m.transportType==="bicycle"||m.transportType==="walk").reduce((m,s)=>m+s.kilometers,0),h=l>0?E/l*100:0,u=c.length>0?c[c.length-1]:l,R=u>0?(l-u)/u*100:0,T=this.calculateTransportTypeDistribution(v),x={value:y,direction:y>0?"up":y<0?"down":"neutral",isPositive:y<=5},b=this.calculateEmissionsTrend(i),A=e.generateSparklinePath(r),S=e.getSparklineEndPoint(r),M=e.generateSparklinePath(a),N=e.getSparklineEndPoint(a),_=e.generateSparklinePath(i),U=e.getSparklineEndPoint(i);return[{title:"Kil\xF3metros Recorridos",primaryValue:l.toFixed(1),primaryUnit:"km",secondaryValue:y.toFixed(1)+"%",secondaryUnit:"vs anterior",status:Math.abs(y)<20?"info":y>0?"warning":"success",trend:x,footerText:"\xDAltimo mes",sparklinePath:A,sparklineEndPoint:S},{title:"Costo de Transporte",primaryValue:k.toFixed(0),primaryUnit:"MXN",status:k>u*1.2?"danger":k<u*.8?"success":"warning",footerText:"Total del \xFAltimo mes",sparklinePath:M,sparklineEndPoint:N},{title:"Emisiones CO2",primaryValue:f.toFixed(1),primaryUnit:"kg",status:b.isPositive?"success":"danger",trend:b,footerText:"Basado en tipos de transporte",sparklinePath:_,sparklineEndPoint:U},{title:"Transporte Sostenible",primaryValue:h.toFixed(1),primaryUnit:"%",secondaryValue:`${E.toFixed(1)} km`,secondaryUnit:"bicicleta/a pie",status:h>=this.SUSTAINABLE_TRANSPORT_TARGET*100?"success":h>=this.SUSTAINABLE_TRANSPORT_TARGET*50?"warning":"danger",footerText:"Meta: 40% del total"},{title:"Distribuci\xF3n de Transporte",primaryValue:T.primary.type,primaryUnit:`${T.primary.percentage.toFixed(0)}%`,secondaryValue:T.secondary.type,secondaryUnit:`${T.secondary.percentage.toFixed(0)}%`,status:T.primary.type==="bicycle"||T.primary.type==="walk"?"success":T.primary.type==="bus"?"info":"warning",footerText:"Tipos de transporte m\xE1s usados"},{title:"Eficiencia de Transporte",primaryValue:(f/l).toFixed(2),primaryUnit:"kg CO2/km",status:f/l<.1?"success":f/l<.15?"warning":"danger",footerText:"Menor valor = mayor eficiencia"}]}generateEmptyKpis(){return[{title:"Kil\xF3metros Recorridos",primaryValue:"0",primaryUnit:"km",status:"neutral",footerText:"No hay datos disponibles"},{title:"Costo de Transporte",primaryValue:"0",primaryUnit:"MXN",status:"neutral",footerText:"No hay datos disponibles"},{title:"Emisiones CO2",primaryValue:"0",primaryUnit:"kg",status:"neutral",footerText:"No hay datos disponibles"},{title:"Transporte Sostenible",primaryValue:"0",primaryUnit:"%",status:"neutral",footerText:"No hay datos para analizar"},{title:"Distribuci\xF3n de Transporte",primaryValue:"N/A",primaryUnit:"",status:"neutral",footerText:"No hay datos disponibles"},{title:"Eficiencia de Transporte",primaryValue:"0",primaryUnit:"kg CO2/km",status:"neutral",footerText:"No hay datos disponibles"}]}groupMonthlyData(t){if(t.length===0)return[];let e=[],n=[],o=-1;for(let r of t){let a=new Date(r.date),i=a.getMonth()+a.getFullYear()*12;o===-1?(o=i,n.push(r)):i===o?n.push(r):(e.push([...n]),n=[r],o=i)}return n.length>0&&e.push(n),e}calculateCO2(t){let e=0;switch(t.transportType){case"car":e=this.CO2_PER_KM_CAR;break;case"bus":e=this.CO2_PER_KM_BUS;break;case"bicycle":e=this.CO2_PER_KM_BICYCLE;break;case"walk":e=this.CO2_PER_KM_WALK;break;case"other":e=this.CO2_PER_KM_OTHER;break}return t.kilometers*e}calculateMovingAverages(t){let e=[];for(let n=0;n<t.length;n++){let o=Math.max(0,n-2),r=t.slice(o,n+1),a=r.reduce((i,c)=>i+c,0);e.push(a/r.length)}return e}calculateTransportTypeDistribution(t){if(t.length===0)return{primary:{type:"N/A",percentage:0},secondary:{type:"N/A",percentage:0}};let e=t.reduce((r,a)=>r+a.kilometers,0),n={};for(let r of t){let a=this.getTransportTypeDisplayName(r.transportType);n[a]=(n[a]||0)+r.kilometers}let o=Object.entries(n).map(([r,a])=>({type:r,km:a,percentage:a/e*100})).sort((r,a)=>a.km-r.km);return{primary:{type:o[0]?.type||"N/A",percentage:o[0]?.percentage||0},secondary:{type:o[1]?.type||"N/A",percentage:o[1]?.percentage||0}}}calculateEmissionsTrend(t){if(t.length<2)return{value:0,direction:"neutral",isPositive:!0};let e=t[t.length-1],n=t[t.length-2],o=n>0?(e-n)/n*100:0;return{value:o,direction:o>0?"up":o<0?"down":"neutral",isPositive:o<=0}}getTransportTypeDisplayName(t){switch(t){case"car":return"Autom\xF3vil";case"bus":return"Autob\xFAs";case"bicycle":return"Bicicleta";case"walk":return"A pie";case"other":return"Otro";default:return t}}static \u0275fac=function(e){return new(e||d)};static \u0275prov=P({token:d,factory:d.\u0275fac,providedIn:"root"})};export{K as a,I as b,V as c};
