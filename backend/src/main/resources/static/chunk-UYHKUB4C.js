import{a as fe,b as _e,c as ve}from"./chunk-II6Z5L4D.js";import{a as ee,b as S,c as te,d as ie,e as oe,g as ne,i as re,j as ae,k as le,l as ce,m as se,n as me,o as de,p as pe,s as ge,u as ue}from"./chunk-NX5UWNHD.js";import{a as K}from"./chunk-HPUDPAOB.js";import"./chunk-EENQT4EC.js";import{$ as n,A as f,B as _,C,D as F,F as L,Ha as X,Ia as k,K as q,L as a,N as I,O,Pa as B,S as p,U as $,V as l,X as x,Xa as Y,Za as Z,_ as r,_a as J,aa as g,c as P,da as y,ea as b,fa as m,ha as H,ia as Q,ja as W,la as s,ma as M,na as w,o as z,ta as G,u as R,z as j}from"./chunk-HBL3S35I.js";var A=class i{compressImage(e,t=1,o=.7){return P(this,null,function*(){if(e.size<=t*1024*1024)return console.log("Image already under size limit, no compression needed"),e;try{let c=yield createImageBitmap(e),u=document.createElement("canvas"),d=c.width,v=c.height,E=1920;(d>E||v>E)&&(d>v?(v=Math.round(v*(E/d)),d=E):(d=Math.round(d*(E/v)),v=E)),u.width=d,u.height=v;let V=u.getContext("2d");if(!V)throw new Error("No se pudo obtener el contexto 2D");V.drawImage(c,0,0,d,v);let h=null,N=o;for(;N>=.2&&(h=yield new Promise(D=>{u.toBlob(U=>{D(U)},e.type,N)}),!(h&&h.size<=t*1024*1024));)N-=.1;if(h&&h.size>t*1024*1024&&(u.width=Math.floor(d/2),u.height=Math.floor(v/2),V.drawImage(c,0,0,u.width,u.height),h=yield new Promise(D=>{u.toBlob(U=>{D(U)},e.type,.7)})),!h)throw new Error("Failed to compress image");return console.log(`Compressed image from ${(e.size/1024/1024).toFixed(2)}MB to ${(h.size/1024/1024).toFixed(2)}MB`),new File([h],e.name,{type:e.type,lastModified:e.lastModified})}catch(c){return console.error("Error compressing image:",c),e}})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=R({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ee=["fileInput"];function we(i,e){if(i&1){let t=y();r(0,"div",7),C(),r(1,"svg",8),g(2,"path",9)(3,"line",10)(4,"line",11)(5,"circle",12)(6,"path",13),n(),F(),r(7,"button",14),b("click",function(){f(t);let c=m();return _(c.openFileDialog())}),s(8," Seleccionar imagen "),n()()}}function Se(i,e){if(i&1){let t=y();r(0,"div",15),g(1,"img",16),r(2,"div",17)(3,"button",18),b("click",function(){f(t);let c=m();return _(c.removeImage())}),C(),r(4,"svg",19),g(5,"path",20)(6,"path",21),n(),s(7," Eliminar "),n(),F(),r(8,"button",22),b("click",function(){f(t);let c=m();return _(c.openFileDialog())}),C(),r(9,"svg",19),g(10,"path",23),n(),s(11," Cambiar "),n()()()}if(i&2){let t=m();a(),l("src",t.imagePreview,q)}}function Fe(i,e){if(i&1&&(r(0,"div",24),s(1),n()),i&2){let t=m();a(),w(" ",t.error," ")}}function Me(i,e){i&1&&(r(0,"div",25),g(1,"div",26),r(2,"span"),s(3,"Optimizando imagen..."),n()())}var T=class i{constructor(e){this.imageCompressionService=e}existingImageUrl;imageSelected=new L;imageRemoved=new L;fileInput;imagePreview=null;isDraggingOver=!1;error=null;selectedFile=null;isCompressing=!1;MAX_FILE_SIZE=1*1024*1024;ALLOWED_TYPES=["image/jpeg","image/png","image/gif","image/webp"];ngOnInit(){this.existingImageUrl&&(this.imagePreview=this.existingImageUrl)}ngOnChanges(){this.existingImageUrl&&(this.imagePreview=this.existingImageUrl)}openFileDialog(){this.fileInput&&this.fileInput.nativeElement&&this.fileInput.nativeElement.click()}onDragOver(e){e.preventDefault(),e.stopPropagation(),this.isDraggingOver=!0}onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.isDraggingOver=!1}onDrop(e){e.preventDefault(),e.stopPropagation(),this.isDraggingOver=!1,e.dataTransfer?.files&&e.dataTransfer.files.length>0&&this.handleFile(e.dataTransfer.files[0])}onFileSelected(e){let t=e.target;t.files&&t.files.length>0&&this.handleFile(t.files[0])}handleFile(e){return P(this,null,function*(){if(!this.ALLOWED_TYPES.includes(e.type)){this.error="Formato no v\xE1lido. Por favor, selecciona una imagen (JPEG, PNG, GIF o WebP).";return}try{if(e.size>this.MAX_FILE_SIZE){this.isCompressing=!0,console.log(`Compressing image: ${(e.size/(1024*1024)).toFixed(2)}MB`);let t=yield this.imageCompressionService.compressImage(e,.95);console.log(`Compression complete: ${(t.size/(1024*1024)).toFixed(2)}MB`),this.processFile(t)}else this.processFile(e)}catch(t){console.error("Error processing file:",t),this.error="Error al procesar la imagen. Por favor, intenta con otra."}finally{this.isCompressing=!1}})}removeImage(){this.imagePreview=null,this.selectedFile=null,this.error=null,this.imageRemoved.emit(),this.fileInput&&this.fileInput.nativeElement&&(this.fileInput.nativeElement.value="")}processFile(e){if(this.error=null,e.size>5*1024*1024){this.error="La imagen es demasiado grande. El tama\xF1o m\xE1ximo permitido es 5MB.";return}let t=new FileReader;t.onload=o=>{this.imagePreview=o.target?.result},t.readAsDataURL(e),this.selectedFile=e,this.imageSelected.emit(e)}static \u0275fac=function(t){return new(t||i)(I(A))};static \u0275cmp=O({type:i,selectors:[["app-image-upload"]],viewQuery:function(t,o){if(t&1&&H(Ee,5),t&2){let c;Q(c=W())&&(o.fileInput=c.first)}},inputs:{existingImageUrl:"existingImageUrl"},outputs:{imageSelected:"imageSelected",imageRemoved:"imageRemoved"},features:[j],decls:7,vars:9,consts:[["fileInput",""],[1,"image-upload-container",3,"dragover","dragleave","drop"],["class","upload-placeholder",4,"ngIf"],["class","image-preview-container",4,"ngIf"],["class","error-message",4,"ngIf"],["type","file","accept","image/*",1,"file-input",3,"change"],["class","compression-indicator",4,"ngIf"],[1,"upload-placeholder"],["xmlns","http://www.w3.org/2000/svg","width","48","height","48","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7"],["x1","16","y1","5","x2","22","y2","5"],["x1","19","y1","2","x2","19","y2","8"],["cx","9","cy","9","r","2"],["d","m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"],["type","button",1,"select-button",3,"click"],[1,"image-preview-container"],["alt","Vista previa de imagen",1,"image-preview",3,"src"],[1,"image-actions"],["type","button",1,"remove-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M18 6L6 18"],["d","M6 6l12 12"],["type","button",1,"change-button",3,"click"],["d","M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"],[1,"error-message"],[1,"compression-indicator"],[1,"spinner"]],template:function(t,o){if(t&1){let c=y();r(0,"div",1),b("dragover",function(d){return f(c),_(o.onDragOver(d))})("dragleave",function(d){return f(c),_(o.onDragLeave(d))})("drop",function(d){return f(c),_(o.onDrop(d))}),p(1,we,9,0,"div",2)(2,Se,12,1,"div",3)(3,Fe,2,1,"div",4),r(4,"input",5,0),b("change",function(d){return f(c),_(o.onFileSelected(d))}),n(),p(6,Me,4,0,"div",6),n()}t&2&&(x("has-image",o.imagePreview)("dragover",o.isDraggingOver),a(),l("ngIf",!o.imagePreview),a(),l("ngIf",o.imagePreview),a(),l("ngIf",o.error),a(),$("aria-label","Seleccionar imagen"),a(2),l("ngIf",o.isCompressing))},dependencies:[B,k],styles:[".image-upload-container[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:8px;padding:24px;text-align:center;background-color:#f9f9f9;transition:all .3s ease;position:relative;min-height:200px;display:flex;flex-direction:column;justify-content:center;align-items:center}.image-upload-container.dragover[_ngcontent-%COMP%]{border-color:#00b359;background-color:#00b3590d}.image-upload-container.has-image[_ngcontent-%COMP%]{border-style:solid;background-color:#fff}.upload-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;color:#666}.upload-placeholder[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#888;margin-bottom:16px}.upload-text[_ngcontent-%COMP%]{margin-bottom:16px;font-size:1rem}.upload-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;margin:8px 0;font-size:.9rem;color:#888}.select-button[_ngcontent-%COMP%]{background-color:#00b359;color:#fff;border:none;border-radius:4px;padding:8px 16px;cursor:pointer;font-weight:500;transition:background-color .3s ease}.select-button[_ngcontent-%COMP%]:hover{background-color:#009649}.file-input[_ngcontent-%COMP%]{display:none}.image-preview-container[_ngcontent-%COMP%]{width:100%;position:relative}.image-preview[_ngcontent-%COMP%]{max-width:100%;max-height:300px;border-radius:4px;object-fit:contain}.image-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:16px;margin-top:16px}.remove-button[_ngcontent-%COMP%], .change-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:.9rem;transition:all .2s ease}.remove-button[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.change-button[_ngcontent-%COMP%]{background-color:#e2f3ff;color:#0c5460;border:1px solid #bee5eb}.remove-button[_ngcontent-%COMP%]:hover{background-color:#f1b0b7}.change-button[_ngcontent-%COMP%]:hover{background-color:#d1ecf1}.error-message[_ngcontent-%COMP%]{margin-top:8px;color:#dc3545;font-size:.9rem}.compression-indicator[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#fffc;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10;border-radius:8px}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(0,179,89,.2);border-radius:50%;border-top-color:#00b359;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})};var he=()=>["/bitacoras"];function Pe(i,e){if(i&1&&(r(0,"div",9),g(1,"div",10),r(2,"p"),s(3),n()()),i&2){let t=m();a(3),M(t.isEditMode?"Cargando bit\xE1cora...":"Preparando formulario...")}}function Oe(i,e){if(i&1){let t=y();r(0,"button",17),b("click",function(){f(t);let c=m(2);return _(c.loadBitacora())}),s(1,"Reintentar"),n()}}function ke(i,e){if(i&1&&(r(0,"div",11),C(),r(1,"svg",12),g(2,"circle",13)(3,"line",14)(4,"line",15),n(),F(),r(5,"p"),s(6),n(),p(7,Oe,2,0,"button",16),n()),i&2){let t=m();a(6),M(t.error),a(),l("ngIf",t.isEditMode)}}function Be(i,e){i&1&&(r(0,"div"),s(1,"El t\xEDtulo es obligatorio"),n())}function Ae(i,e){i&1&&(r(0,"div"),s(1,"El t\xEDtulo no puede exceder los 100 caracteres"),n())}function Te(i,e){if(i&1&&(r(0,"div",43),p(1,Be,2,0,"div",44)(2,Ae,2,0,"div",44),n()),i&2){let t=m(2);a(),l("ngIf",t.f.titulo.errors.required),a(),l("ngIf",t.f.titulo.errors.maxlength)}}function Ve(i,e){i&1&&(r(0,"div"),s(1,"La fecha es obligatoria"),n())}function Ne(i,e){if(i&1&&(r(0,"div",43),p(1,Ve,2,0,"div",44),n()),i&2){let t=m(2);a(),l("ngIf",t.f.fecha.errors.required)}}function De(i,e){if(i&1&&(r(0,"option",45),s(1),n()),i&2){let t=e.$implicit;l("value",t[0]),a(),M(t[1])}}function Ue(i,e){i&1&&(r(0,"div"),s(1,"La categor\xEDa es obligatoria"),n())}function ze(i,e){if(i&1&&(r(0,"div",43),p(1,Ue,2,0,"div",44),n()),i&2){let t=m(2);a(),l("ngIf",t.f.categoria.errors.required)}}function Le(i,e){i&1&&(r(0,"small",46),s(1," La imagen ser\xE1 optimizada autom\xE1ticamente para mejorar el rendimiento. "),n())}function Ge(i,e){i&1&&(r(0,"span",23),s(1,"*"),n())}function Re(i,e){if(i&1&&g(0,"input",56),i&2){let t=m().$implicit,o=m(3);x("is-invalid",o.isSubmitted&&o.camposAdicionales[t.nombre]&&o.camposAdicionales[t.nombre].errors),l("type","text")("id",t.nombre)("formControlName",t.nombre)("placeholder",t.placeholder||"")}}function je(i,e){if(i&1&&g(0,"input",57),i&2){let t=m().$implicit,o=m(3);x("is-invalid",o.isSubmitted&&o.camposAdicionales[t.nombre]&&o.camposAdicionales[t.nombre].errors),l("id",t.nombre)("formControlName",t.nombre)}}function qe(i,e){if(i&1&&g(0,"input",58),i&2){let t=m().$implicit,o=m(3);x("is-invalid",o.isSubmitted&&o.camposAdicionales[t.nombre]&&o.camposAdicionales[t.nombre].errors),l("id",t.nombre)("formControlName",t.nombre)}}function $e(i,e){if(i&1&&(r(0,"option",45),s(1),n()),i&2){let t=e.$implicit;l("value",t),a(),M(t)}}function He(i,e){if(i&1&&(r(0,"select",59)(1,"option",32),s(2,"Seleccionar"),n(),p(3,$e,2,2,"option",33),n()),i&2){let t=m().$implicit,o=m(3);x("is-invalid",o.isSubmitted&&o.camposAdicionales[t.nombre]&&o.camposAdicionales[t.nombre].errors),l("id",t.nombre)("formControlName",t.nombre),a(3),l("ngForOf",t.opciones)}}function Qe(i,e){i&1&&(r(0,"div"),s(1," Este campo es obligatorio "),n())}function We(i,e){i&1&&(r(0,"div"),s(1," Este campo debe contener un n\xFAmero "),n())}function Xe(i,e){i&1&&(r(0,"div"),s(1," Este campo debe contener un n\xFAmero entero (sin decimales) "),n())}function Ye(i,e){i&1&&(r(0,"div"),s(1," Este campo debe contener un n\xFAmero positivo mayor que cero "),n())}function Ze(i,e){if(i&1&&(r(0,"div",43),p(1,Qe,2,0,"div",44)(2,We,2,0,"div",44)(3,Xe,2,0,"div",44)(4,Ye,2,0,"div",44),n()),i&2){let t=m().$implicit,o=m(3);a(),l("ngIf",o.camposAdicionales[t.nombre].errors&&o.camposAdicionales[t.nombre].hasError("required")),a(),l("ngIf",o.camposAdicionales[t.nombre].errors&&o.camposAdicionales[t.nombre].hasError("notNumber")),a(),l("ngIf",o.camposAdicionales[t.nombre].errors&&o.camposAdicionales[t.nombre].hasError("notInteger")),a(),l("ngIf",o.camposAdicionales[t.nombre].errors&&o.camposAdicionales[t.nombre].hasError("notPositive"))}}function Je(i,e){if(i&1&&(r(0,"div",49)(1,"label",50),s(2),p(3,Ge,2,0,"span",51),n(),p(4,Re,1,6,"input",52)(5,je,1,4,"input",53)(6,qe,1,4,"input",54)(7,He,4,5,"select",55)(8,Ze,5,4,"div",25),n()),i&2){let t=e.$implicit,o=m(3);l("formGroupName","camposAdicionales"),a(),l("for",t.nombre),a(),w(" ",t.etiqueta," "),a(),l("ngIf",t.requerido),a(),l("ngIf",t.tipo==="texto"),a(),l("ngIf",t.tipo==="numero"),a(),l("ngIf",t.tipo==="fecha"),a(),l("ngIf",t.tipo==="seleccion"),a(),l("ngIf",o.isSubmitted&&o.camposAdicionales&&o.camposAdicionales[t.nombre]&&o.camposAdicionales[t.nombre].errors)}}function Ke(i,e){if(i&1&&(r(0,"div",47)(1,"h3"),s(2,"Informaci\xF3n adicional"),n(),p(3,Je,9,9,"div",48),n()),i&2){let t=m(2);a(3),l("ngForOf",t.selectedCamposAdicionales)}}function et(i,e){i&1&&(C(),r(0,"svg",3),g(1,"path",60)(2,"polyline",61)(3,"polyline",62),n())}function tt(i,e){i&1&&g(0,"span",63)}function it(i,e){if(i&1){let t=y();r(0,"form",18),b("ngSubmit",function(){f(t);let c=m();return _(c.onSubmit())}),r(1,"div",19)(2,"div",20)(3,"div",21)(4,"label",22),s(5,"T\xEDtulo "),r(6,"span",23),s(7,"*"),n()(),g(8,"input",24),p(9,Te,3,2,"div",25),n(),r(10,"div",21)(11,"label",26),s(12,"Descripci\xF3n"),n(),g(13,"textarea",27),n(),r(14,"div",21)(15,"label",28),s(16,"Fecha "),r(17,"span",23),s(18,"*"),n()(),g(19,"input",29),p(20,Ne,2,1,"div",25),n(),r(21,"div",21)(22,"label",30),s(23,"Categor\xEDa "),r(24,"span",23),s(25,"*"),n()(),r(26,"select",31),b("change",function(){f(t);let c=m();return _(c.onCategoriaChange())}),r(27,"option",32),s(28,"Seleccionar categor\xEDa"),n(),p(29,De,2,2,"option",33),n(),p(30,ze,2,1,"div",25),n()(),r(31,"div",20)(32,"div",21)(33,"label",34),s(34,"Imagen"),n(),r(35,"app-image-upload",35),b("imageSelected",function(c){f(t);let u=m();return _(u.onImageSelected(c))})("imageRemoved",function(){f(t);let c=m();return _(c.onImageRemoved())}),n(),p(36,Le,2,0,"small",36),n(),p(37,Ke,4,1,"div",37),n()(),r(38,"div",38)(39,"button",39),s(40,"Cancelar"),n(),r(41,"button",40),p(42,et,4,0,"svg",41)(43,tt,1,0,"span",42),s(44),n()()()}if(i&2){let t,o=m();l("formGroup",o.bitacoraForm),a(8),x("is-invalid",o.isSubmitted&&o.f.titulo.errors),a(),l("ngIf",o.isSubmitted&&o.f.titulo.errors),a(10),x("is-invalid",o.isSubmitted&&o.f.fecha.errors),a(),l("ngIf",o.isSubmitted&&o.f.fecha.errors),a(6),x("is-invalid",o.isSubmitted&&o.f.categoria.errors),a(3),l("ngForOf",o.categoriaEntries),a(),l("ngIf",o.isSubmitted&&o.f.categoria.errors),a(5),l("existingImageUrl",(t=o.existingImageUrl)!==null&&t!==void 0?t:void 0),a(),l("ngIf",o.selectedImage&&o.selectedImage.size>1024*1024),a(),l("ngIf",o.selectedCamposAdicionales.length>0),a(2),l("routerLink",G(19,he)),a(2),l("disabled",o.submitting),a(),l("ngIf",!o.submitting),a(),l("ngIf",o.submitting),a(),w(" ",o.submitting?"Guardando...":"Guardar"," ")}}function ot(){return i=>{if(i.value===null||i.value===void 0||i.value==="")return{required:!0};let e=Number(i.value);return isNaN(e)?{notNumber:!0}:Number.isInteger(e)?e<=0?{notPositive:!0}:null:{notInteger:!0}}}function nt(){return i=>{if(i.value===null||i.value===void 0||i.value==="")return{required:!0};let e=Number(i.value);return isNaN(e)?{notNumber:!0}:e<=0?{notPositive:!0}:null}}var xe=class i{constructor(e,t,o,c){this.fb=e;this.bitacoraService=t;this.router=o;this.route=c}bitacoraForm=null;loading=!1;submitting=!1;error=null;isSubmitted=!1;isEditMode=!1;bitacoraId;selectedImage=null;existingImageUrl=null;selectedCamposAdicionales=[];categoriasConDecimales=["reciclaje","limpieza_ambiental","limpieza-ambiental","limpieza","limpieza ambiental"];categoriaEntries=Object.entries(_e);ngOnInit(){this.bitacoraId=+this.route.snapshot.paramMap.get("id"),this.isEditMode=!isNaN(this.bitacoraId)&&this.bitacoraId>0,this.isEditMode?this.loadBitacora():this.initForm()}get f(){return this.bitacoraForm?.controls??{}}get camposAdicionales(){let e=this.f.camposAdicionales;return e instanceof oe?e.controls:{}}loadBitacora(){this.loading=!0,this.error=null,this.bitacoraService.getBitacoraById(this.bitacoraId).pipe(z(()=>this.loading=!1)).subscribe({next:e=>{this.initForm(e),e.imagenUrl&&(this.existingImageUrl=this.bitacoraService.getImageUrl(e.imagenUrl)),this.updateAdditionalFields(e.categoria,e.camposAdicionales)},error:e=>{this.error=e.message||"Error al cargar la bit\xE1cora"}})}initForm(e){let o=new Date().toISOString().split("T")[0];this.bitacoraForm=this.fb.group({titulo:[e?.titulo||"",[S.required,S.maxLength(100)]],descripcion:[e?.descripcion||""],fecha:[e?.fecha?new Date(e.fecha).toISOString().split("T")[0]:o,S.required],categoria:[e?.categoria||"",S.required],camposAdicionales:this.fb.group({})}),e?.categoria&&this.updateAdditionalFields(e.categoria,e.camposAdicionales)}onCategoriaChange(){let e=this.f.categoria?.value;if(console.log("Categor\xEDa seleccionada:",e),console.log("\xBFPermite decimales?",this.categoriasConDecimales.includes(e)),e)this.updateAdditionalFields(e);else{this.selectedCamposAdicionales=[];let t=this.bitacoraForm?.get("camposAdicionales");t&&Object.keys(t.controls).forEach(o=>{t.removeControl(o)})}}updateAdditionalFields(e,t){this.selectedCamposAdicionales=fe[e]||[],console.log("Actualizando campos para categor\xEDa:",e),console.log("\xBFPermite decimales?",this.categoriasConDecimales.includes(e));let o=this.bitacoraForm?.get("camposAdicionales");o&&(Object.keys(o.controls).forEach(c=>{o.removeControl(c)}),this.selectedCamposAdicionales.forEach(c=>{let u=t?.[c.nombre]||"",d=[];c.tipo==="numero"?(console.log("Campo num\xE9rico encontrado:",c.nombre),this.categoriasConDecimales.includes(e)?(console.log("Aplicando validador de decimales para:",c.nombre),d.push(nt())):(console.log("Aplicando validador de enteros para:",c.nombre),d.push(ot()))):c.requerido&&d.push(S.required),o.addControl(c.nombre,new ne(u,d))}))}onImageSelected(e){this.selectedImage=e}onImageRemoved(){this.selectedImage=null,this.existingImageUrl=null}onSubmit(){if(this.isSubmitted=!0,this.bitacoraForm?.invalid){let d=document.querySelectorAll(".is-invalid");d.length>0&&d[0].scrollIntoView({behavior:"smooth",block:"center"});return}this.submitting=!0,this.error=null;let e=this.bitacoraForm.value,o=new Date(e.fecha).toISOString().split("T")[0]+"T00:00:00",c={titulo:e.titulo,descripcion:e.descripcion,fecha:new Date(e.fecha),categoria:e.categoria,camposAdicionales:e.camposAdicionales};(this.isEditMode?this.bitacoraService.updateBitacora(this.bitacoraId,c,this.selectedImage||void 0,o):this.bitacoraService.createBitacora(c,this.selectedImage||void 0,o)).pipe(z(()=>this.submitting=!1)).subscribe({next:()=>{this.router.navigate(["/bitacoras"])},error:d=>{this.error=d.message||`Error al ${this.isEditMode?"actualizar":"crear"} la bit\xE1cora`,setTimeout(()=>{let v=document.querySelector(".error-message");v&&v.scrollIntoView({behavior:"smooth",block:"center"})},100)}})}static \u0275fac=function(t){return new(t||i)(I(ge),I(ve),I(Z),I(Y))};static \u0275cmp=O({type:i,selectors:[["app-bitacora-form"]],decls:13,vars:6,consts:[[1,"container"],[1,"page-header"],[1,"btn-back",3,"routerLink"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","19","y1","12","x2","5","y2","12"],["points","12 19 5 12 12 5"],["class","loading-container",4,"ngIf"],["class","error-message",4,"ngIf"],["class","bitacora-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-container"],[1,"loading-spinner"],[1,"error-message"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","12"],["x1","12","y1","16","x2","12.01","y2","16"],["class","btn-retry",3,"click",4,"ngIf"],[1,"btn-retry",3,"click"],[1,"bitacora-form",3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"form-column"],[1,"form-group"],["for","titulo",1,"form-label"],[1,"required"],["type","text","id","titulo","formControlName","titulo",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","descripcion",1,"form-label"],["id","descripcion","formControlName","descripcion","rows","4",1,"form-control"],["for","fecha",1,"form-label"],["type","date","id","fecha","formControlName","fecha",1,"form-control"],["for","categoria",1,"form-label"],["id","categoria","formControlName","categoria",1,"form-control",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-label"],[3,"imageSelected","imageRemoved","existingImageUrl"],["class","form-text text-muted",4,"ngIf"],["class","additional-fields",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn-cancel",3,"routerLink"],["type","submit",1,"btn-save",3,"disabled"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",4,"ngIf"],["class","loading-spinner-small",4,"ngIf"],[1,"invalid-feedback"],[4,"ngIf"],[3,"value"],[1,"form-text","text-muted"],[1,"additional-fields"],["class","form-group",3,"formGroupName",4,"ngFor","ngForOf"],[1,"form-group",3,"formGroupName"],[1,"form-label",3,"for"],["class","required",4,"ngIf"],["class","form-control",3,"type","id","formControlName","placeholder","is-invalid",4,"ngIf"],["type","number","class","form-control",3,"id","formControlName","is-invalid",4,"ngIf"],["type","date","class","form-control",3,"id","formControlName","is-invalid",4,"ngIf"],["class","form-control",3,"id","formControlName","is-invalid",4,"ngIf"],[1,"form-control",3,"type","id","formControlName","placeholder"],["type","number",1,"form-control",3,"id","formControlName"],["type","date",1,"form-control",3,"id","formControlName"],[1,"form-control",3,"id","formControlName"],["d","M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"],["points","17 21 17 13 7 13 7 21"],["points","7 3 7 8 15 8"],[1,"loading-spinner-small"]],template:function(t,o){t&1&&(g(0,"app-navbar"),r(1,"div",0)(2,"div",1)(3,"h2"),s(4),n(),r(5,"a",2),C(),r(6,"svg",3),g(7,"line",4)(8,"polyline",5),n(),s(9," Volver "),n()(),p(10,Pe,4,1,"div",6)(11,ke,8,2,"div",7)(12,it,45,20,"form",8),n()),t&2&&(a(4),w("",o.isEditMode?"Editar":"Crear"," Bit\xE1cora"),a(),l("routerLink",G(5,he)),a(5),l("ngIf",o.loading),a(),l("ngIf",o.error),a(),l("ngIf",!o.loading&&o.bitacoraForm))},dependencies:[B,X,k,ue,re,de,pe,ee,ae,me,te,ie,le,se,ce,J,K,T],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#00b359;margin:0}.btn-back[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;background-color:#f5f5f5;color:#333;border-radius:4px;text-decoration:none;transition:background-color .3s ease}.btn-back[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 0}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(0,179,89,.2);border-radius:50%;border-top-color:#00b359;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}.loading-spinner-small[_ngcontent-%COMP%]{display:inline-block;width:20px;height:20px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-message[_ngcontent-%COMP%]{background-color:#f8d7da;border:1px solid #f5c6cb;border-radius:4px;padding:16px;margin-bottom:24px;color:#721c24;display:flex;align-items:center;gap:12px}.btn-retry[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;border-radius:4px;padding:6px 12px;cursor:pointer;margin-left:auto}.bitacora-form[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;padding:24px;box-shadow:0 2px 8px #0000001a}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:500;color:#333}.required[_ngcontent-%COMP%]{color:#dc3545}.form-control[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border:1px solid #ced4da;border-radius:4px;font-size:1rem;transition:border-color .3s ease}.form-control[_ngcontent-%COMP%]:focus{border-color:#00b359;outline:none}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:100px}.invalid-feedback[_ngcontent-%COMP%]{color:#dc3545;font-size:.875rem;margin-top:4px}.additional-fields[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid #eee}.additional-fields[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:16px;color:#333}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;margin-top:24px;padding-top:16px;border-top:1px solid #eee}.btn-cancel[_ngcontent-%COMP%], .btn-save[_ngcontent-%COMP%]{padding:10px 20px;border-radius:4px;font-weight:500;cursor:pointer;display:inline-flex;align-items:center;gap:8px}.btn-cancel[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #dee2e6;color:#212529;text-decoration:none}.btn-save[_ngcontent-%COMP%]{background-color:#00b359;border:1px solid #00b359;color:#fff}.btn-cancel[_ngcontent-%COMP%]:hover{background-color:#e2e6ea}.btn-save[_ngcontent-%COMP%]:hover{background-color:#009649}.btn-save[_ngcontent-%COMP%]:disabled{background-color:#6acf9a;border-color:#6acf9a;cursor:not-allowed}@media (max-width: 768px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{xe as BitacoraFormComponent};
