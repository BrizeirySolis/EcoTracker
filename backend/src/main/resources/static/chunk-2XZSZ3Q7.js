import{Qa as c,d as i,f as o,j as a,s as u,v as l}from"./chunk-K5VQB3RE.js";var m={production:!0,apiUrl:"/api"};var p=class t{constructor(r){this.http=r;let e=localStorage.getItem("currentUser");this.currentUserSubject=new o(e?JSON.parse(e):null),this.currentUser=this.currentUserSubject.asObservable(),console.log("AuthService iniciado, usuario almacenado:",e?JSON.parse(e)?.username:"ninguno"),this.currentUserSubject=new o(e?JSON.parse(e):null),this.currentUser=this.currentUserSubject.asObservable(),console.log("AuthService iniciado, usuario almacenado:",e?JSON.parse(e)?.username:"ninguno")}API_URL=`${m.apiUrl}/auth`;currentUserSubject;currentUser;get currentUserValue(){return this.currentUserSubject.value}signup(r){return this.http.post(`${this.API_URL}/signup`,r)}login(r){return console.log("Intentando login con:",r.username),this.http.post(`${this.API_URL}/signin`,r).pipe(a(e=>{if(console.log("Respuesta completa del login:",e),!e.token)throw console.error("No se recibi\xF3 token en la respuesta"),new Error("No se recibi\xF3 un token v\xE1lido del servidor");let s=e.token.startsWith("Bearer ")?e.token:`Bearer ${e.token}`;console.log("Token formateado: "+s.substring(0,20)+"...");let n={id:e.id,username:e.username,email:e.email,name:e.name||e.username,roles:e.roles,token:s};return localStorage.setItem("currentUser",JSON.stringify(n)),console.log("Usuario guardado en localStorage"),this.currentUserSubject.next(n),n}))}logout(){localStorage.removeItem("currentUser"),this.currentUserSubject.next(null),console.log("Usuario desconectado")}isLoggedIn(){let r=this.currentUserValue;return!!r&&!!r.token}refreshToken(){return new i(r=>{r.next(null),r.complete()})}static \u0275fac=function(e){return new(e||t)(l(c))};static \u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"})};export{m as a,p as b};
