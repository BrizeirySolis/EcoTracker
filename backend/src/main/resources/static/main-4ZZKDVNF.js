import{a as w,b as x,c as F}from"./chunk-WBOXEDLB.js";import{b as p}from"./chunk-2XZSZ3Q7.js";import{$a as U,M as R,Ra as k,Sa as y,Ta as E,Wa as H,Xa as c,Y as u,Z as d,_ as S,_a as I,i as v,ja as b,l as g,s as A,v as s,w as l,ya as T}from"./chunk-K5VQB3RE.js";var e=class t{constructor(r,o){this.router=r;this.authService=o}canActivate(r,o){if(this.authService.isLoggedIn()){if(r.data.roles&&r.data.roles.length){let a=this.authService.currentUserValue?.roles||[];if(!r.data.roles.some(n=>a.includes(n)))return this.router.navigate(["/home"]),!1}return!0}return this.router.navigate(["/login"],{queryParams:{returnUrl:o.url}}),!1}static \u0275fac=function(o){return new(o||t)(s(c),s(p))};static \u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"})};var M=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-WCZAU7M3.js").then(t=>t.HomeComponent)},{path:"login",loadComponent:()=>import("./chunk-BBFMTX46.js").then(t=>t.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-ZXTWULEL.js").then(t=>t.RegisterComponent)},{path:"habitos",loadComponent:()=>import("./chunk-3JA2MSYK.js").then(t=>t.HabitsComponent),canActivate:[e]},{path:"luz",loadComponent:()=>import("./chunk-ELDIB7XI.js").then(t=>t.ElectricityFormComponent),canActivate:[e]},{path:"agua",loadComponent:()=>import("./chunk-6VLAS35W.js").then(t=>t.WaterFormComponent),canActivate:[e]},{path:"transporte",loadComponent:()=>import("./chunk-XIX2CDCQ.js").then(t=>t.TransportFormComponent),canActivate:[e]},{path:"profile",loadComponent:()=>import("./chunk-EROXMXAO.js").then(t=>t.ProfileComponent),canActivate:[e]},{path:"bitacoras",loadComponent:()=>import("./chunk-3JYC4IAB.js").then(t=>t.BitacoraListComponent),canActivate:[e]},{path:"bitacoras/new",loadComponent:()=>import("./chunk-ZHTIIILZ.js").then(t=>t.BitacoraFormComponent),canActivate:[e]},{path:"bitacoras/edit/:id",loadComponent:()=>import("./chunk-ZHTIIILZ.js").then(t=>t.BitacoraFormComponent),canActivate:[e]},{path:"bitacoras/:id",loadComponent:()=>import("./chunk-KDL76NSI.js").then(t=>t.BitacoraDetailComponent),canActivate:[e]},{path:"bitacoras/timeline",loadComponent:()=>import("./chunk-3E5FFNVQ.js").then(t=>t.BitacoraTimelineComponent),canActivate:[e]},{path:"metas",loadComponent:()=>import("./chunk-IOXLBSET.js").then(t=>t.MetaListComponent),canActivate:[e]},{path:"metas/new",loadComponent:()=>import("./chunk-NSVA7QDW.js").then(t=>t.MetaFormComponent),canActivate:[e]},{path:"metas/edit/:id",loadComponent:()=>import("./chunk-NSVA7QDW.js").then(t=>t.MetaFormComponent),canActivate:[e]},{path:"metas/:id",loadComponent:()=>import("./chunk-4NC6XPTY.js").then(t=>t.MetaDetailComponent),canActivate:[e]},{path:"educacion",loadComponent:()=>import("./chunk-NLFLZDVJ.js").then(t=>t.EducationHomeComponent),canActivate:[e],data:{title:"Centro Educativo",description:"Aprende t\xE9cnicas para reducir tu impacto ambiental"}},{path:"educacion/agua",redirectTo:"educacion/categoria/agua",pathMatch:"full"},{path:"educacion/electricidad",redirectTo:"educacion/categoria/electricidad",pathMatch:"full"},{path:"educacion/transporte",redirectTo:"educacion/categoria/transporte",pathMatch:"full"},{path:"educacion/categoria/:categoria",loadComponent:()=>import("./chunk-DVF5JVE7.js").then(t=>t.CategoryViewComponent),canActivate:[e],data:{title:"Categor\xEDa Educativa",description:"Art\xEDculos de una categor\xEDa espec\xEDfica"}},{path:"educacion/:tipo/:slug",loadComponent:()=>import("./chunk-ACU3CFGK.js").then(t=>t.ArticleViewerComponent),canActivate:[e],data:{title:"Art\xEDculo Educativo",description:"Contenido educativo sobre sostenibilidad"}},{path:"**",redirectTo:"/home"}];var P=(t,r)=>{let o=l(p),a=l(c);console.log(`Interceptando solicitud a: ${t.url}`);let i=localStorage.getItem("currentUser");console.log("Usuario en localStorage:",i?"Presente":"Ausente");let h=o.currentUserValue;if(console.log("Usuario en servicio:",h?"Presente":"Ausente"),t.url.includes("/api/")&&i){let n=JSON.parse(i);if(n&&n.token){let f=n.token.startsWith("Bearer ")?n.token:`Bearer ${n.token}`;console.log(`A\xF1adiendo token a solicitud: ${f.substring(0,20)}...`);let O=t.clone({headers:t.headers.set("Authorization",f)});return r(O).pipe(g(C=>(C.status===401&&(console.error("Error 401: Token inv\xE1lido o expirado"),localStorage.removeItem("currentUser"),o.logout(),a.navigate(["/login"],{queryParams:{returnUrl:a.url}})),v(()=>C))))}}return console.log("Solicitud sin token de autorizaci\xF3n"),r(t)};var B={providers:[T({eventCoalescing:!0}),I(M,U({skipInitialTransition:!0,onViewTransitionCreated:t=>{console.log("View transition created for:",t.to.url)}})),k(y([P])),x,F,w]};var m=class t{title="EcoTracker";static \u0275fac=function(o){return new(o||t)};static \u0275cmp=R({type:t,selectors:[["app-root"]],decls:5,vars:0,template:function(o,a){o&1&&(u(0,"main"),S(1,"router-outlet"),d(),u(2,"footer")(3,"p"),b(4,"\xA9 2025 EcoTracker - Proyecto educativo"),d()())},dependencies:[H],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;min-height:100vh}main[_ngcontent-%COMP%]{flex:1}footer[_ngcontent-%COMP%]{background-color:#333;color:#fff;text-align:center;padding:16px;margin-top:40px}"]})};E(m,B).catch(t=>console.error(t));
