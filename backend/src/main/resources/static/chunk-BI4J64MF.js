import{b as T,c as q}from"./chunk-II6Z5L4D.js";import{c as A,h as W,n as H,o as R,p as J,t as U}from"./chunk-NX5UWNHD.js";import{a as $}from"./chunk-HPUDPAOB.js";import"./chunk-EENQT4EC.js";import{$ as r,A as u,B as f,C as b,D as C,Ha as L,Ia as D,L as a,N as I,O as F,Pa as j,S as p,U as N,V as c,X as V,_ as o,_a as z,aa as g,da as O,ea as v,fa as m,i as B,la as s,ma as _,n as S,na as G,o as E,oa as Y,pa as k,qa as P,ra as w,ta as h,ua as y}from"./chunk-HBL3S35I.js";var Z=()=>["/bitacoras"],Q=()=>["/bitacoras/new"],X=n=>["/bitacoras",n],ee=n=>["/bitacoras/edit",n];function te(n,t){n&1&&(o(0,"div",15),g(1,"div",16),o(2,"p"),s(3,"Cargando bit\xE1coras..."),r()())}function ne(n,t){n&1&&(o(0,"div",17),b(),o(1,"svg",18),g(2,"path",19)(3,"polyline",20)(4,"line",21)(5,"line",22),r(),C(),o(6,"h3"),s(7,"No hay bit\xE1coras disponibles"),r(),o(8,"p"),s(9,"Comienza registrando tus actividades ambientales."),r(),o(10,"a",23),s(11,"Crear primera bit\xE1cora"),r()()),n&2&&(a(10),c("routerLink",h(1,Q)))}function ie(n,t){if(n&1){let e=O();o(0,"div",24),b(),o(1,"svg",25),g(2,"circle",26)(3,"line",27)(4,"line",28),r(),C(),o(5,"p"),s(6),r(),o(7,"button",29),v("click",function(){u(e);let l=m();return f(l.loadBitacoras())}),s(8,"Reintentar"),r()()}if(n&2){let e=m();a(6),_(e.error)}}function oe(n,t){if(n&1&&(o(0,"option",39),s(1),r()),n&2){let e=t.$implicit;c("value",e[0]),a(),_(e[1])}}function re(n,t){if(n&1&&(o(0,"option",39),s(1),r()),n&2){let e=t.$implicit;c("value",e),a(),_(e)}}function ae(n,t){if(n&1){let e=O();o(0,"div",30)(1,"div",31)(2,"label",32),s(3,"Filtrar por categor\xEDa:"),r(),o(4,"select",33),w("ngModelChange",function(l){u(e);let d=m();return P(d.selectedCategoria,l)||(d.selectedCategoria=l),f(l)}),v("change",function(){u(e);let l=m();return f(l.onCategoriaFilterChange())}),o(5,"option",34),s(6,"Todas las categor\xEDas"),r(),p(7,oe,2,2,"option",35),r()(),o(8,"div",31)(9,"label",36),s(10,"Filtrar por a\xF1o:"),r(),o(11,"select",37),w("ngModelChange",function(l){u(e);let d=m();return P(d.selectedYear,l)||(d.selectedYear=l),f(l)}),v("change",function(){u(e);let l=m();return f(l.onYearFilterChange())}),o(12,"option",38),s(13,"Todos los a\xF1os"),r(),p(14,re,2,2,"option",35),r()()()}if(n&2){let e=m();a(4),k("ngModel",e.selectedCategoria),a(3),c("ngForOf",e.categoriaEntries),a(4),k("ngModel",e.selectedYear),a(3),c("ngForOf",e.availableYears)}}function le(n,t){if(n&1&&(o(0,"a",60),s(1),r()),n&2){let e=m().$implicit;c("routerLink",y(2,X,e.id)),a(),G(" ",e.titulo," ")}}function ce(n,t){if(n&1&&(o(0,"span"),s(1),r()),n&2){let e=m().$implicit;a(),_(e.titulo)}}function se(n,t){if(n&1&&(o(0,"a",61),s(1," Ver "),r()),n&2){let e=m().$implicit;c("routerLink",y(1,X,e.id))}}function de(n,t){if(n&1&&(o(0,"a",62),s(1," Editar "),r()),n&2){let e=m().$implicit;c("routerLink",y(1,ee,e.id))}}function me(n,t){n&1&&(o(0,"span",63),s(1,"Ver"),r())}function pe(n,t){n&1&&(o(0,"span",64),s(1,"Editar"),r())}function ge(n,t){if(n&1&&(o(0,"div",49),g(1,"div",50),o(2,"div",51)(3,"h3",52),p(4,le,2,4,"a",53)(5,ce,2,1,"span",54),r(),o(6,"div",55),p(7,se,2,3,"a",56)(8,de,2,3,"a",57)(9,me,2,0,"span",58)(10,pe,2,0,"span",59),r()()()),n&2){let e=t.$implicit,i=t.index,l=m().$implicit,d=m(2);V("first-entry",i===0)("last-entry",i===l.bitacoras.length-1),a(),N("data-category",e.categoria),a(3),c("ngIf",d.isValidId(e.id)),a(),c("ngIf",!d.isValidId(e.id)),a(2),c("ngIf",d.isValidId(e.id)),a(),c("ngIf",d.isValidId(e.id)),a(),c("ngIf",!d.isValidId(e.id)),a(),c("ngIf",!d.isValidId(e.id))}}function ue(n,t){if(n&1&&(o(0,"div",43)(1,"div",44)(2,"div",45),s(3),r(),o(4,"div",46),s(5),r()(),o(6,"div",47),p(7,ge,11,11,"div",48),r()()),n&2){let e=t.$implicit;a(3),_(e.displayText),a(2),Y("",e.bitacoras.length," ",e.bitacoras.length===1?"actividad":"actividades",""),a(2),c("ngForOf",e.bitacoras)}}function fe(n,t){if(n&1&&(o(0,"div",40)(1,"div",41),p(2,ue,8,4,"div",42),r()()),n&2){let e=m();a(2),c("ngForOf",e.timelineGroups)}}var K=class n{constructor(t){this.bitacoraService=t}bitacoras=[];timelineGroups=[];loading=!0;error=null;selectedCategoria="";selectedYear=0;categoriaEntries=Object.entries(T);availableYears=[];ngOnInit(){this.loadBitacoras()}loadBitacoras(){this.loading=!0,this.error=null,console.log("BitacoraTimelineComponent: Solicitando bit\xE1coras, categor\xEDa:",this.selectedCategoria),this.bitacoraService.getAllBitacoras(!0,this.selectedCategoria).pipe(S(t=>(this.error=t.message||"Error al cargar las bit\xE1coras",B([]))),E(()=>this.loading=!1)).subscribe(t=>{console.log("BitacoraTimelineComponent: Bit\xE1coras recibidas:",t),console.log("BitacoraTimelineComponent: Detalles de la primera bit\xE1cora (si existe):",t.length>0?{id:t[0].id,titulo:t[0].titulo,fecha:t[0].fecha,categoria:t[0].categoria,tipo_id:typeof t[0].id}:"No hay bit\xE1coras"),this.bitacoras=t.filter(e=>this.hasValidId(e)),console.log("Bit\xE1coras cargadas:",this.bitacoras.length),console.log("Ejemplos de IDs:",this.bitacoras.slice(0,3).map(e=>e.id)),this.extractYears(),this.groupBitacorasByMonthYear()})}extractYears(){let t=new Set;this.bitacoras.forEach(e=>{let i=new Date(e.fecha).getFullYear();t.add(i)}),this.availableYears=Array.from(t).sort((e,i)=>i-e)}groupBitacorasByMonthYear(){console.log("BitacoraTimelineComponent: Iniciando agrupaci\xF3n por mes/a\xF1o, total bit\xE1coras:",this.bitacoras.length);let t={},e=this.selectedYear>0?this.bitacoras.filter(i=>new Date(i.fecha).getFullYear()===this.selectedYear):this.bitacoras;console.log("BitacoraTimelineComponent: Bit\xE1coras despu\xE9s de filtro por a\xF1o:",e.length,"A\xF1o seleccionado:",this.selectedYear),e.forEach(i=>{if(!this.hasValidId(i)){console.warn("Skipping bit\xE1cora without valid ID:",i);return}let l=new Date(i.fecha),d=l.getFullYear(),M=l.getMonth(),x=`${d}-${M}`;t[x]||(t[x]={monthYear:x,year:d,month:M,displayText:this.getMonthYearDisplay(M,d),bitacoras:[]}),t[x].bitacoras.push(i)}),console.log("BitacoraTimelineComponent: Total de grupos creados:",Object.keys(t).length),this.timelineGroups=Object.values(t).sort((i,l)=>i.year!==l.year?l.year-i.year:l.month-i.month),this.timelineGroups.forEach(i=>{i.bitacoras.sort((l,d)=>new Date(d.fecha).getTime()-new Date(l.fecha).getTime())}),console.log("BitacoraTimelineComponent: Grupos ordenados:",this.timelineGroups.map(i=>`${i.displayText}: ${i.bitacoras.length} bit\xE1coras`)),console.log("Grupos de timeline generados:",this.timelineGroups.length),this.timelineGroups.length>0&&console.log("Ejemplo del primer grupo:",this.timelineGroups[0].displayText,this.timelineGroups[0].bitacoras.length)}getMonthYearDisplay(t,e){return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][t]} ${e}`}onCategoriaFilterChange(){this.loadBitacoras()}onYearFilterChange(){this.groupBitacorasByMonthYear()}getImageUrl(t){return this.bitacoraService.getImageUrl(t)}getCategoriaName(t){return T[t]||t}truncateText(t,e){return t.length<=e?t:t.slice(0,e)+"..."}hasValidId(t){return t?.id!==void 0&&t?.id!==null&&!isNaN(Number(t.id))&&Number(t.id)>0}getBitacoraLink(t){let e=t?.id;return e!=null&&!isNaN(Number(e))&&Number(e)>0?["/bitacoras",String(e)]:(console.warn("Intentando crear enlace para bit\xE1cora con ID inv\xE1lido:",e,typeof e,t),["/bitacoras"])}getEditLink(t){let e=t?.id;return e!=null&&!isNaN(Number(e))&&Number(e)>0?["/bitacoras/edit",String(e)]:(console.warn("Intentando crear enlace de edici\xF3n para bit\xE1cora con ID inv\xE1lido:",e,typeof e,t),["/bitacoras"])}isValidId(t){return t!=null&&!isNaN(Number(t))&&Number(t)>0}static \u0275fac=function(e){return new(e||n)(I(q))};static \u0275cmp=F({type:n,selectors:[["app-bitacora-timeline"]],decls:21,vars:9,consts:[[1,"container"],[1,"page-header"],[1,"header-actions"],[1,"btn-back",3,"routerLink"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","19","y1","12","x2","5","y2","12"],["points","12 19 5 12 12 5"],[1,"btn-create",3,"routerLink"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","error-message",4,"ngIf"],["class","filter-container",4,"ngIf"],["class","timeline-container",4,"ngIf"],[1,"loading-container"],[1,"loading-spinner"],[1,"empty-state"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","1","stroke-linecap","round","stroke-linejoin","round"],["d","M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"],["points","14 2 14 8 20 8"],["x1","12","y1","18","x2","12","y2","12"],["x1","9","y1","15","x2","15","y2","15"],[1,"btn-create-empty",3,"routerLink"],[1,"error-message"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","12"],["x1","12","y1","16","x2","12.01","y2","16"],[1,"btn-retry",3,"click"],[1,"filter-container"],[1,"filter-group"],["for","categoria-filter"],["id","categoria-filter",1,"categoria-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","year-filter"],["id","year-filter",1,"year-select",3,"ngModelChange","change","ngModel"],["value","0"],[3,"value"],[1,"timeline-container"],[1,"timeline"],["class","timeline-group",4,"ngFor","ngForOf"],[1,"timeline-group"],[1,"timeline-group-label"],[1,"timeline-date"],[1,"timeline-count"],[1,"timeline-entries"],["class","timeline-entry",3,"first-entry","last-entry",4,"ngFor","ngForOf"],[1,"timeline-entry"],[1,"timeline-marker"],[1,"timeline-content"],[1,"timeline-title"],[3,"routerLink",4,"ngIf"],[4,"ngIf"],[1,"timeline-actions"],["class","btn-view",3,"routerLink",4,"ngIf"],["class","btn-edit",3,"routerLink",4,"ngIf"],["class","btn-view disabled",4,"ngIf"],["class","btn-edit disabled",4,"ngIf"],[3,"routerLink"],[1,"btn-view",3,"routerLink"],[1,"btn-edit",3,"routerLink"],[1,"btn-view","disabled"],[1,"btn-edit","disabled"]],template:function(e,i){e&1&&(g(0,"app-navbar"),o(1,"div",0)(2,"div",1)(3,"h2"),s(4,"L\xEDnea de Tiempo de Bit\xE1coras"),r(),o(5,"div",2)(6,"a",3),b(),o(7,"svg",4),g(8,"line",5)(9,"polyline",6),r(),s(10," Ver vista de lista "),r(),C(),o(11,"a",7),b(),o(12,"svg",4),g(13,"line",8)(14,"line",9),r(),s(15," Crear Bit\xE1cora "),r()()(),p(16,te,4,0,"div",10)(17,ne,12,2,"div",11)(18,ie,9,1,"div",12)(19,ae,15,4,"div",13)(20,fe,3,1,"div",14),r()),e&2&&(a(6),c("routerLink",h(7,Z)),a(5),c("routerLink",h(8,Q)),a(5),c("ngIf",i.loading),a(),c("ngIf",!i.loading&&(!i.timelineGroups||i.timelineGroups.length===0)),a(),c("ngIf",i.error),a(),c("ngIf",!i.loading&&i.timelineGroups&&i.timelineGroups.length>0),a(),c("ngIf",!i.loading&&i.timelineGroups&&i.timelineGroups.length>0))},dependencies:[j,L,D,z,U,R,J,H,A,W,$],styles:['.container[_ngcontent-%COMP%]{padding:20px;max-width:900px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#00b359;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.btn-back[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;background-color:#f5f5f5;color:#333;border-radius:4px;text-decoration:none;transition:background-color .3s ease}.btn-back[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.btn-create[_ngcontent-%COMP%]{display:inline-flex;align-items:center;background-color:#00b359;color:#fff;text-decoration:none;padding:8px 16px;border-radius:4px;font-weight:500;gap:8px;transition:background-color .3s ease}.btn-create[_ngcontent-%COMP%]:hover{background-color:#00994d}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 0}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(0,179,89,.2);border-radius:50%;border-top-color:#00b359;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px 0;color:#666}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#aaa;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:12px;color:#333}.btn-create-empty[_ngcontent-%COMP%]{display:inline-block;background-color:#00b359;color:#fff;text-decoration:none;padding:10px 20px;border-radius:4px;font-weight:500;margin-top:16px;transition:background-color .3s ease}.btn-create-empty[_ngcontent-%COMP%]:hover{background-color:#00994d}.error-message[_ngcontent-%COMP%]{background-color:#f8d7da;border:1px solid #f5c6cb;border-radius:4px;padding:16px;margin-bottom:24px;color:#721c24;display:flex;align-items:center;gap:12px}.btn-retry[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;border-radius:4px;padding:6px 12px;cursor:pointer;margin-left:auto}.filter-container[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:24px;flex-wrap:wrap}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.categoria-select[_ngcontent-%COMP%], .year-select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #ccc;border-radius:4px;background-color:#fff;font-size:.9rem}.timeline-container[_ngcontent-%COMP%]{position:relative}.timeline[_ngcontent-%COMP%]{position:relative;padding-top:16px}.timeline[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;bottom:0;left:16px;width:2px;background-color:#e0e0e0}.timeline-group[_ngcontent-%COMP%]{margin-bottom:32px}.timeline-group-label[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:12px;position:relative;z-index:2}.timeline-date[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;color:#333;background-color:#f5f5f5;padding:8px 12px;border-radius:4px;margin-left:24px}.timeline-count[_ngcontent-%COMP%]{font-size:.9rem;color:#666;margin-left:12px}.timeline-entries[_ngcontent-%COMP%]{position:relative}.timeline-entry[_ngcontent-%COMP%]{position:relative;padding-left:36px;margin-bottom:24px}.timeline-entry[_ngcontent-%COMP%]:last-child{margin-bottom:0}.timeline-marker[_ngcontent-%COMP%]{position:absolute;top:4px;left:8px;width:16px;height:16px;border-radius:50%;background-color:#999;z-index:2}.timeline-marker[data-category=plantacion][_ngcontent-%COMP%]{background-color:#2e7d32}.timeline-marker[data-category=reciclaje][_ngcontent-%COMP%]{background-color:#1976d2}.timeline-marker[data-category=conservacion][_ngcontent-%COMP%]{background-color:#00838f}.timeline-marker[data-category=educacion][_ngcontent-%COMP%]{background-color:#ff8f00}.timeline-marker[data-category=ahorro][_ngcontent-%COMP%]{background-color:#7b1fa2}.timeline-marker[data-category=consumo][_ngcontent-%COMP%]{background-color:#e65100}.timeline-marker[data-category=limpieza][_ngcontent-%COMP%]{background-color:#3949ab}.timeline-marker[data-category=otro][_ngcontent-%COMP%]{background-color:#616161}.timeline-content[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;padding:16px;box-shadow:0 2px 8px #0000001a}.timeline-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.timeline-category[_ngcontent-%COMP%]{display:inline-block;font-size:.8rem;font-weight:600;padding:4px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.5px}.timeline-category[data-category=plantacion][_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.timeline-category[data-category=reciclaje][_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.timeline-category[data-category=conservacion][_ngcontent-%COMP%]{background-color:#e0f7fa;color:#00838f}.timeline-category[data-category=educacion][_ngcontent-%COMP%]{background-color:#fff8e1;color:#ff8f00}.timeline-category[data-category=ahorro][_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.timeline-category[data-category=consumo][_ngcontent-%COMP%]{background-color:#fff3e0;color:#e65100}.timeline-category[data-category=limpieza][_ngcontent-%COMP%]{background-color:#e8eaf6;color:#3949ab}.timeline-category[data-category=otro][_ngcontent-%COMP%]{background-color:#f5f5f5;color:#616161}.timeline-date-small[_ngcontent-%COMP%]{font-size:.9rem;color:#666}.timeline-title[_ngcontent-%COMP%]{font-size:1.2rem;margin:0 0 8px}.timeline-title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#333;text-decoration:none;transition:color .3s ease}.timeline-title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#00b359}.timeline-description[_ngcontent-%COMP%]{font-size:.95rem;color:#555;margin:0 0 16px;line-height:1.5}.timeline-image[_ngcontent-%COMP%]{margin-bottom:16px;border-radius:6px;overflow:hidden}.timeline-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;max-height:200px;object-fit:cover;transition:transform .3s ease}.timeline-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.timeline-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.btn-view[_ngcontent-%COMP%], .btn-edit[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;border-radius:4px;font-size:.9rem;text-decoration:none;transition:all .2s ease}.btn-view[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2;border:1px solid #bbdefb}.btn-edit[_ngcontent-%COMP%]{background-color:#fff8e1;color:#ff8f00;border:1px solid #ffe082}.btn-view[_ngcontent-%COMP%]:hover{background-color:#bbdefb}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#ffe082}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.header-actions[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.filter-container[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.filter-group[_ngcontent-%COMP%]{width:100%}.categoria-select[_ngcontent-%COMP%], .year-select[_ngcontent-%COMP%]{flex-grow:1}.btn-view.disabled[_ngcontent-%COMP%], .btn-edit.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed;pointer-events:none;background-color:#f0f0f0}}']})};export{K as BitacoraTimelineComponent};
