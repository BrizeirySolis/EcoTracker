import{b as k,c as Q}from"./chunk-II6Z5L4D.js";import{c as $,h as W,n as q,o as Y,p as J,t as K}from"./chunk-NX5UWNHD.js";import{a as A}from"./chunk-HPUDPAOB.js";import"./chunk-EENQT4EC.js";import{$ as o,A as b,B as x,C as g,D as u,Ha as j,Ia as z,K as E,L as a,N as M,Na as N,O as B,Pa as G,S as m,U as L,V as l,Za as R,_ as t,_a as H,aa as s,cb as U,da as C,ea as f,fa as d,i as P,la as r,ma as v,n as S,na as h,o as y,pa as I,qa as T,ra as V,ta as w,ua as O,wa as D,ya as F}from"./chunk-HBL3S35I.js";var Z=()=>["/bitacoras/new"],ee=n=>["/bitacoras",n],te=n=>["/bitacoras/edit",n];function ne(n,i){if(n&1&&(t(0,"option",17),r(1),o()),n&2){let e=i.$implicit;l("value",e[0]),a(),v(e[1])}}function ie(n,i){n&1&&(t(0,"div",18),s(1,"div",19),t(2,"p"),r(3,"Cargando bit\xE1coras..."),o()())}function oe(n,i){n&1&&(t(0,"p"),r(1,"No hay bit\xE1coras en la categor\xEDa seleccionada."),o())}function ae(n,i){n&1&&(t(0,"p"),r(1,"Comienza registrando tus actividades ambientales."),o())}function re(n,i){if(n&1&&(t(0,"div",20),g(),t(1,"svg",21),s(2,"path",22)(3,"polyline",23)(4,"line",24)(5,"line",25),o(),u(),t(6,"h3"),r(7,"No hay bit\xE1coras disponibles"),o(),m(8,oe,2,0,"p",26)(9,ae,2,0,"p",26),t(10,"a",27),r(11,"Crear primera bit\xE1cora"),o()()),n&2){let e=d();a(8),l("ngIf",e.selectedCategoria),a(),l("ngIf",!e.selectedCategoria),a(),l("routerLink",w(3,Z))}}function ce(n,i){if(n&1){let e=C();t(0,"div",28),g(),t(1,"svg",29),s(2,"circle",30)(3,"line",31)(4,"line",32),o(),u(),t(5,"p"),r(6),o(),t(7,"button",33),f("click",function(){b(e);let p=d();return x(p.loadBitacoras())}),r(8,"Reintentar"),o()()}if(n&2){let e=d();a(6),v(e.error)}}function le(n,i){if(n&1&&s(0,"img",55),n&2){let e=d().$implicit,c=d(2);l("src",c.getImageUrl(e.imagenUrl),E)("alt",e.titulo)}}function de(n,i){n&1&&(t(0,"div",56),g(),t(1,"svg",57),s(2,"rect",58)(3,"circle",59)(4,"polyline",60),o()())}function se(n,i){if(n&1&&(t(0,"p",61),r(1),o()),n&2){let e=d().$implicit,c=d(2);a(),h(" ",c.truncateText(e.descripcion,100)," ")}}function pe(n,i){if(n&1){let e=C();t(0,"div",36)(1,"div",37),m(2,le,1,2,"img",38)(3,de,5,0,"div",39),o(),t(4,"div",40)(5,"div",41),r(6),o(),t(7,"h3",42),r(8),o(),t(9,"p",43),r(10),D(11,"date"),o(),m(12,se,2,1,"p",44),t(13,"div",45)(14,"a",46),g(),t(15,"svg",47),s(16,"path",48)(17,"circle",49),o(),r(18," Ver "),o(),u(),t(19,"a",50),g(),t(20,"svg",47),s(21,"path",51),o(),r(22," Editar "),o(),u(),t(23,"button",52),f("click",function(){let p=b(e).$implicit,_=d(2);return x(_.confirmDelete(p))}),g(),t(24,"svg",47),s(25,"polyline",53)(26,"path",54),o(),r(27," Eliminar "),o()()()()}if(n&2){let e=i.$implicit,c=d(2);a(2),l("ngIf",e.imagenUrl),a(),l("ngIf",!e.imagenUrl),a(2),L("data-category",e.categoria),a(),h(" ",c.getCategoriaName(e.categoria)," "),a(2),v(e.titulo),a(2),v(F(11,9,e.fecha,"dd/MM/yyyy")),a(2),l("ngIf",e.descripcion),a(2),l("routerLink",O(12,ee,e.id)),a(5),l("routerLink",O(14,te,e.id))}}function ge(n,i){if(n&1&&(t(0,"div",34),m(1,pe,28,16,"div",35),o()),n&2){let e=d();a(),l("ngForOf",e.bitacoras)}}function me(n,i){n&1&&(t(0,"span"),r(1,"Eliminar"),o())}function fe(n,i){n&1&&(t(0,"span"),r(1,"Eliminando..."),o())}function be(n,i){if(n&1){let e=C();t(0,"div",62)(1,"div",63)(2,"div",64)(3,"div",65)(4,"h3"),r(5,"Confirmar eliminaci\xF3n"),o(),t(6,"button",66),f("click",function(){b(e);let p=d();return x(p.cancelDelete())}),g(),t(7,"svg",29),s(8,"line",67)(9,"line",68),o()()(),u(),t(10,"div",69)(11,"p"),r(12,"\xBFEst\xE1s seguro de que deseas eliminar la bit\xE1cora "),t(13,"strong"),r(14),o(),r(15,"?"),o(),t(16,"p",70),r(17,"Esta acci\xF3n no se puede deshacer."),o()(),t(18,"div",71)(19,"button",72),f("click",function(){b(e);let p=d();return x(p.cancelDelete())}),r(20,"Cancelar"),o(),t(21,"button",73),f("click",function(){b(e);let p=d();return x(p.deleteBitacora())}),m(22,me,2,0,"span",26)(23,fe,2,0,"span",26),o()()()()()}if(n&2){let e=d();a(14),h('"',e.bitacoraToDelete==null?null:e.bitacoraToDelete.titulo,'"'),a(7),l("disabled",e.deleting),a(),l("ngIf",!e.deleting),a(),l("ngIf",e.deleting)}}var X=class n{constructor(i,e){this.bitacoraService=i;this.router=e}bitacoras=[];loading=!0;error=null;selectedCategoria="";categoriaEntries=Object.entries(k);showDeleteModal=!1;bitacoraToDelete=null;deleting=!1;bitacorasSubscription=null;routerSubscription=null;ngOnInit(){this.bitacorasSubscription=this.bitacoraService.bitacoras$.subscribe(i=>{console.log(`Received ${i.length} bit\xE1coras from service`),this.bitacoras=i}),this.loadBitacoras()}loadBitacoras(){this.loading=!0,this.error=null,console.log("Filtrando por categor\xEDa:",this.selectedCategoria),this.bitacoraService.getAllBitacoras(!0,this.selectedCategoria).pipe(S(i=>(this.error=i.message||"Error al cargar las bit\xE1coras",P([]))),y(()=>this.loading=!1)).subscribe(i=>{console.log("Bit\xE1coras recibidas:",i.length),console.log("Categor\xEDas recibidas:",i.map(e=>e.categoria).join(", ")),this.bitacoras=i})}onCategoriaFilterChange(){console.log("Categor\xEDa seleccionada:",this.selectedCategoria),this.loadBitacoras()}getImageUrl(i){return this.bitacoraService.getImageUrl(i)}getCategoriaName(i){return k[i]||i}truncateText(i,e){return i.length<=e?i:i.slice(0,e)+"..."}confirmDelete(i){this.bitacoraToDelete=i,this.showDeleteModal=!0}cancelDelete(){this.showDeleteModal=!1,this.bitacoraToDelete=null}deleteBitacora(){!this.bitacoraToDelete||this.deleting||(this.deleting=!0,this.bitacoraService.deleteBitacora(this.bitacoraToDelete.id).pipe(y(()=>{this.deleting=!1,this.showDeleteModal=!1,this.bitacoraToDelete=null})).subscribe({next:()=>{},error:i=>{this.error=i.message||"Error al eliminar la bit\xE1cora"}}))}static \u0275fac=function(e){return new(e||n)(M(Q),M(R))};static \u0275cmp=B({type:n,selectors:[["app-bitacora-list"]],decls:23,vars:9,consts:[[1,"container"],[1,"bitacoras-header"],[1,"actions"],[1,"filter-container"],["for","categoria-filter"],["id","categoria-filter",1,"categoria-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn-create",3,"routerLink"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","error-message",4,"ngIf"],["class","bitacoras-grid",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[3,"value"],[1,"loading-container"],[1,"loading-spinner"],[1,"empty-state"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","1","stroke-linecap","round","stroke-linejoin","round"],["d","M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"],["points","14 2 14 8 20 8"],["x1","12","y1","18","x2","12","y2","12"],["x1","9","y1","15","x2","15","y2","15"],[4,"ngIf"],[1,"btn-create-empty",3,"routerLink"],[1,"error-message"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","12"],["x1","12","y1","16","x2","12.01","y2","16"],[1,"btn-retry",3,"click"],[1,"bitacoras-grid"],["class","bitacora-card",4,"ngFor","ngForOf"],[1,"bitacora-card"],[1,"bitacora-image"],[3,"src","alt",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"bitacora-content"],[1,"bitacora-category"],[1,"bitacora-title"],[1,"bitacora-date"],["class","bitacora-description",4,"ngIf"],[1,"bitacora-actions"],[1,"btn-view",3,"routerLink"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"],["cx","12","cy","12","r","3"],[1,"btn-edit",3,"routerLink"],["d","M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"],[1,"btn-delete",3,"click"],["points","3 6 5 6 21 6"],["d","M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"],[3,"src","alt"],[1,"no-image"],["xmlns","http://www.w3.org/2000/svg","width","48","height","48","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","1","stroke-linecap","round","stroke-linejoin","round"],["x","3","y","3","width","18","height","18","rx","2","ry","2"],["cx","8.5","cy","8.5","r","1.5"],["points","21 15 16 10 5 21"],[1,"bitacora-description"],[1,"modal-overlay"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"btn-close",3,"click"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"modal-body"],[1,"warning-text"],[1,"modal-footer"],[1,"btn-cancel",3,"click"],[1,"btn-confirm-delete",3,"click","disabled"]],template:function(e,c){e&1&&(s(0,"app-navbar"),t(1,"div",0)(2,"div",1)(3,"h2"),r(4,"Mis Bit\xE1coras Ambientales"),o(),t(5,"div",2)(6,"div",3)(7,"label",4),r(8,"Filtrar por:"),o(),t(9,"select",5),V("ngModelChange",function(_){return T(c.selectedCategoria,_)||(c.selectedCategoria=_),_}),f("change",function(){return c.onCategoriaFilterChange()}),t(10,"option",6),r(11,"Todas las categor\xEDas"),o(),m(12,ne,2,2,"option",7),o()(),t(13,"a",8),g(),t(14,"svg",9),s(15,"line",10)(16,"line",11),o(),r(17," Crear Bit\xE1cora "),o()()(),m(18,ie,4,0,"div",12)(19,re,12,4,"div",13)(20,ce,9,1,"div",14)(21,ge,2,1,"div",15)(22,be,24,4,"div",16),o()),e&2&&(a(9),I("ngModel",c.selectedCategoria),a(3),l("ngForOf",c.categoriaEntries),a(),l("routerLink",w(8,Z)),a(5),l("ngIf",c.loading),a(),l("ngIf",!c.loading&&c.bitacoras.length===0),a(),l("ngIf",c.error),a(),l("ngIf",!c.loading&&c.bitacoras.length>0),a(),l("ngIf",c.showDeleteModal))},dependencies:[G,j,z,N,H,U,K,Y,J,q,$,W,A],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.bitacoras-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px}.bitacoras-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#00b359;margin:0}.actions[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;flex-wrap:wrap}.filter-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.categoria-select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #ccc;border-radius:4px;background-color:#fff;font-size:.9rem}.btn-create[_ngcontent-%COMP%]{display:inline-flex;align-items:center;background-color:#00b359;color:#fff;text-decoration:none;padding:8px 16px;border-radius:4px;font-weight:500;gap:8px;transition:background-color .3s ease}.btn-create[_ngcontent-%COMP%]:hover{background-color:#00994d}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 0}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(0,179,89,.2);border-radius:50%;border-top-color:#00b359;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px 0;color:#666}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#aaa;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:12px;color:#333}.btn-create-empty[_ngcontent-%COMP%]{display:inline-block;background-color:#00b359;color:#fff;text-decoration:none;padding:10px 20px;border-radius:4px;font-weight:500;margin-top:16px;transition:background-color .3s ease}.btn-create-empty[_ngcontent-%COMP%]:hover{background-color:#00994d}.error-message[_ngcontent-%COMP%]{background-color:#f8d7da;border:1px solid #f5c6cb;border-radius:4px;padding:16px;margin-bottom:24px;color:#721c24;display:flex;align-items:center;gap:12px}.btn-retry[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;border-radius:4px;padding:6px 12px;cursor:pointer;margin-left:auto}.bitacoras-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:24px}.bitacora-card[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #0000001a;background-color:#fff;transition:transform .3s ease,box-shadow .3s ease}.bitacora-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 4px 12px #00000026}.bitacora-image[_ngcontent-%COMP%]{height:180px;background-color:#f8f9fa;position:relative;overflow:hidden}.bitacora-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.bitacora-card[_ngcontent-%COMP%]:hover   .bitacora-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:scale(1.05)}.no-image[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%;background-color:#f0f0f0;color:#aaa}.bitacora-content[_ngcontent-%COMP%]{padding:16px}.bitacora-category[_ngcontent-%COMP%]{display:inline-block;font-size:.8rem;font-weight:600;padding:4px 8px;border-radius:4px;margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}.bitacora-category[data-category=plantacion][_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.bitacora-category[data-category=reciclaje][_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.bitacora-category[data-category=conservacion][_ngcontent-%COMP%]{background-color:#e0f7fa;color:#00838f}.bitacora-category[data-category=educacion][_ngcontent-%COMP%]{background-color:#fff8e1;color:#ff8f00}.bitacora-category[data-category=ahorro][_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.bitacora-category[data-category=consumo][_ngcontent-%COMP%]{background-color:#fff3e0;color:#e65100}.bitacora-category[data-category=limpieza][_ngcontent-%COMP%]{background-color:#e8eaf6;color:#3949ab}.bitacora-category[data-category=otro][_ngcontent-%COMP%]{background-color:#f5f5f5;color:#616161}.bitacora-title[_ngcontent-%COMP%]{font-size:1.2rem;margin:0 0 4px;color:#333}.bitacora-date[_ngcontent-%COMP%]{font-size:.9rem;color:#666;margin:0 0 8px}.bitacora-description[_ngcontent-%COMP%]{font-size:.95rem;color:#555;margin:0 0 16px;line-height:1.5}.bitacora-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.btn-view[_ngcontent-%COMP%], .btn-edit[_ngcontent-%COMP%], .btn-delete[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;border-radius:4px;font-size:.9rem;cursor:pointer;transition:all .2s ease;text-decoration:none}.btn-view[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2;border:1px solid #bbdefb}.btn-edit[_ngcontent-%COMP%]{background-color:#fff8e1;color:#ff8f00;border:1px solid #ffe082}.btn-delete[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828;border:1px solid #ffcdd2}.btn-view[_ngcontent-%COMP%]:hover{background-color:#bbdefb}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#ffe082}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#ffcdd2}.timeline-link-container[_ngcontent-%COMP%]{text-align:center;margin:32px 0}.timeline-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;background-color:#f5f5f5;color:#333;text-decoration:none;padding:10px 16px;border-radius:4px;font-weight:500;transition:background-color .3s ease}.timeline-link[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-dialog[_ngcontent-%COMP%]{width:100%;max-width:500px;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 4px 12px #0003}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #eee}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333}.btn-close[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#666}.modal-body[_ngcontent-%COMP%]{padding:16px}.warning-text[_ngcontent-%COMP%]{color:#dc3545;font-weight:500}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;padding:16px;border-top:1px solid #eee}.btn-cancel[_ngcontent-%COMP%], .btn-confirm-delete[_ngcontent-%COMP%]{padding:8px 16px;border-radius:4px;font-weight:500;cursor:pointer}.btn-cancel[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #dee2e6;color:#212529}.btn-confirm-delete[_ngcontent-%COMP%]{background-color:#dc3545;border:1px solid #dc3545;color:#fff}.btn-cancel[_ngcontent-%COMP%]:hover{background-color:#e2e6ea}.btn-confirm-delete[_ngcontent-%COMP%]:hover{background-color:#c82333}.btn-confirm-delete[_ngcontent-%COMP%]:disabled{background-color:#e4606d;cursor:not-allowed}@media (max-width: 768px){.bitacoras-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.actions[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.bitacoras-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{X as BitacoraListComponent};
