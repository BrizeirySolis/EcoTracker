import{a as H,b as w,c as E}from"./chunk-XBDBQZUR.js";import{Fa as k,Ga as y,Ha as I,J as R,Ja as U,Ka as p,Na as x,Oa as F,Ra as c,T as u,U as h,V as S,da as b,i as v,l as g,r as A,ra as T,u as s,v as l}from"./chunk-4HKD5D5B.js";var e=class t{constructor(r,o){this.router=r;this.authService=o}canActivate(r,o){if(this.authService.isLoggedIn()){if(r.data.roles&&r.data.roles.length){let i=this.authService.currentUserValue?.roles||[];if(!r.data.roles.some(n=>i.includes(n)))return this.router.navigate(["/home"]),!1}return!0}return this.router.navigate(["/login"],{queryParams:{returnUrl:o.url}}),!1}static \u0275fac=function(o){return new(o||t)(s(p),s(c))};static \u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"})};var P=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-F2C3LUTA.js").then(t=>t.HomeComponent)},{path:"login",loadComponent:()=>import("./chunk-X4QYBYDX.js").then(t=>t.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-JIGT2JBL.js").then(t=>t.RegisterComponent)},{path:"habitos",loadComponent:()=>import("./chunk-ISFG7JMB.js").then(t=>t.HabitsComponent),canActivate:[e]},{path:"luz",loadComponent:()=>import("./chunk-BOKKVAWP.js").then(t=>t.ElectricityFormComponent),canActivate:[e]},{path:"agua",loadComponent:()=>import("./chunk-SO7NRAUW.js").then(t=>t.WaterFormComponent),canActivate:[e]},{path:"transporte",loadComponent:()=>import("./chunk-L2IHHR4Q.js").then(t=>t.TransportFormComponent),canActivate:[e]},{path:"profile",loadComponent:()=>import("./chunk-7B22HYGN.js").then(t=>t.ProfileComponent),canActivate:[e]},{path:"bitacoras",loadComponent:()=>import("./chunk-QHQO4N7I.js").then(t=>t.BitacoraListComponent),canActivate:[e]},{path:"bitacoras/new",loadComponent:()=>import("./chunk-PEAZX6ET.js").then(t=>t.BitacoraFormComponent),canActivate:[e]},{path:"bitacoras/edit/:id",loadComponent:()=>import("./chunk-PEAZX6ET.js").then(t=>t.BitacoraFormComponent),canActivate:[e]},{path:"bitacoras/:id",loadComponent:()=>import("./chunk-D3YWKCPW.js").then(t=>t.BitacoraDetailComponent),canActivate:[e]},{path:"bitacoras/timeline",loadComponent:()=>import("./chunk-BZCNJABG.js").then(t=>t.BitacoraTimelineComponent),canActivate:[e]},{path:"metas",loadComponent:()=>import("./chunk-3A5INX7F.js").then(t=>t.MetaListComponent),canActivate:[e]},{path:"metas/new",loadComponent:()=>import("./chunk-GZTV3GRH.js").then(t=>t.MetaFormComponent),canActivate:[e]},{path:"metas/edit/:id",loadComponent:()=>import("./chunk-GZTV3GRH.js").then(t=>t.MetaFormComponent),canActivate:[e]},{path:"metas/:id",loadComponent:()=>import("./chunk-NKCIRMMN.js").then(t=>t.MetaDetailComponent),canActivate:[e]},{path:"**",redirectTo:"/home"}];var M=(t,r)=>{let o=l(c),i=l(p);console.log(`Interceptando solicitud a: ${t.url}`);let a=localStorage.getItem("currentUser");console.log("Usuario en localStorage:",a?"Presente":"Ausente");let d=o.currentUserValue;if(console.log("Usuario en servicio:",d?"Presente":"Ausente"),t.url.includes("/api/")&&a){let n=JSON.parse(a);if(n&&n.token){let f=n.token.startsWith("Bearer ")?n.token:`Bearer ${n.token}`;console.log(`A\xF1adiendo token a solicitud: ${f.substring(0,20)}...`);let O=t.clone({headers:t.headers.set("Authorization",f)});return r(O).pipe(g(C=>(C.status===401&&(console.error("Error 401: Token inv\xE1lido o expirado"),localStorage.removeItem("currentUser"),o.logout(),i.navigate(["/login"],{queryParams:{returnUrl:i.url}})),v(()=>C))))}}return console.log("Solicitud sin token de autorizaci\xF3n"),r(t)};var B={providers:[T({eventCoalescing:!0}),x(P,F({skipInitialTransition:!0,onViewTransitionCreated:t=>{console.log("View transition created for:",t.to.url)}})),k(y([M])),w,E,H]};var m=class t{title="EcoTracker";static \u0275fac=function(o){return new(o||t)};static \u0275cmp=R({type:t,selectors:[["app-root"]],decls:5,vars:0,template:function(o,i){o&1&&(u(0,"main"),S(1,"router-outlet"),h(),u(2,"footer")(3,"p"),b(4,"\xA9 2025 EcoTracker - Proyecto educativo"),h()())},dependencies:[U],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;min-height:100vh}main[_ngcontent-%COMP%]{flex:1}footer[_ngcontent-%COMP%]{background-color:#333;color:#fff;text-align:center;padding:16px;margin-top:40px}"]})};I(m,B).catch(t=>console.error(t));
